# v1.1.0 Emergency Rollback Playbook

**Purpose**: Quick-action guide for emergency scenarios requiring immediate response
**Audience**: On-Call Engineer, Release Manager, Engineering Lead
**When to Use**: P0 bugs, critical security issues, data integrity problems

---

## üö® Emergency Scenarios

This playbook covers 5 critical emergency scenarios:

1. **P0 Bug Discovered** - Critical functionality broken
2. **Privacy/Security Breach** - PII collected or security vulnerability
3. **Installation Failures** - Users unable to install
4. **Telemetry Backend Failure** - Backend down or data loss
5. **Silent Data Corruption** - Subtle bugs affecting data integrity

---

## Decision Matrix: Do I Need This Playbook?

| Situation | Severity | Use This Playbook? | Alternative |
|-----------|----------|-------------------|-------------|
| User can't generate commands | P0 | ‚úÖ YES | Section 1 |
| PII found in telemetry | CRITICAL | ‚úÖ YES | Section 2 |
| Install script fails on Ubuntu | P1 | ‚ùå No | Standard bug fix process |
| Feature request from user | Enhancement | ‚ùå No | Roadmap planning |
| Documentation typo | Minor | ‚ùå No | Regular PR |
| Telemetry backend 503 error | P0 | ‚úÖ YES | Section 4 |
| Commands work but suboptimal | P2 | ‚ùå No | v1.1.1 planning |
| Binary won't start | P0 | ‚úÖ YES | Section 1 |

**Rule of Thumb**: If it blocks users from core functionality or compromises security/privacy ‚Üí Use this playbook

---

## üî¥ Scenario 1: P0 Bug Discovered

**Definition**: Critical bug that blocks core functionality (command generation, execution, installation)

**Examples**:
- Binary crashes on launch
- "list all files" query fails
- Install script downloads corrupted binary
- Commands execute with wrong permissions

### Immediate Actions (< 15 minutes)

**Step 1: Assess Impact** (5 min)
```bash
# Reproduce the bug
[... steps to reproduce ...]

# Check scope
gh issue list --label "P0" --state open
# How many users affected? (check telemetry, GitHub issues, social media)

# Severity check
# - Affects all users? ‚Üí CRITICAL
# - Affects specific platform only? ‚Üí HIGH
# - Requires specific conditions? ‚Üí MODERATE
```

**Step 2: Create GitHub Issue** (3 min)
```bash
gh issue create \
  --label "P0" \
  --label "v1.1.0" \
  --title "P0: [Brief description]" \
  --body "**Impact**: [All users / macOS only / etc]
**Reproduction**:
1. Step 1
2. Step 2
**Expected**: [...]
**Actual**: [...]
**First Reported**: [Date/time, source]
**Workaround**: [If known, else 'None']"
```

**Step 3: Add Warning to Release** (2 min)
```bash
# Update GitHub release with warning banner
gh release edit v1.1.0 --notes "$(cat <<'EOF'
‚ö†Ô∏è **KNOWN CRITICAL ISSUE**

A critical bug has been identified: [Brief description]

**Impact**: [Scope]
**Status**: Fix in progress, v1.1.1 hotfix coming within 24 hours
**Workaround**: [If available]
**Issue**: #XXX

We recommend waiting for v1.1.1 before installing. If you've already installed, [workaround or rollback instructions].

---

[Original release notes follow...]
EOF
)"
```

**Step 4: Add Warning to README** (2 min)
```bash
git checkout main
git pull origin main

# Add prominent warning at top
cat > ALERT.md <<'EOF'
> üö® **CRITICAL ISSUE IN v1.1.0**
>
> A critical bug affects v1.1.0: [Description]
>
> **Do NOT install v1.1.0.** Fix coming in v1.1.1 within 24 hours.
>
> **Issue**: [#XXX](link)
> **Workaround**: [If available]
>
> ---

EOF

cat ALERT.md README.md > README_NEW.md
mv README_NEW.md README.md
rm ALERT.md

git commit -am "docs: Add critical issue warning for v1.1.0"
git push origin main
```

**Step 5: Notify Stakeholders** (3 min)
```bash
# Slack/Discord/Email template
echo "üö® CRITICAL: v1.1.0 P0 Bug

Issue: [Brief description]
Impact: [Scope]
Status: Fix in progress
ETA: v1.1.1 within 24 hours

Actions taken:
- GitHub release updated with warning
- README updated with alert
- Issue #XXX created

Next: Hotfix branch created, fix development starting

" | [send to team channel]
```

---

### Hotfix Development (< 24 hours)

**Step 6: Create Hotfix Branch** (5 min)
```bash
# Start from v1.1.0 tag (NOT from main)
git checkout -b hotfix/v1.1.1 v1.1.0

# Verify you're on the right commit
git log -1 --oneline
# Expected: Shows v1.1.0 release commit
```

**Step 7: Develop Minimal Fix** (depends on bug)
```bash
# Principle: MINIMAL changes only
# - Fix the P0 bug
# - Add regression test
# - NO other changes (no refactoring, no features)

[... implement fix ...]

# Add regression test
[... add test that fails on v1.1.0, passes on fix ...]
```

**Step 8: Test Thoroughly** (2-4 hours)
```bash
# 1. Unit tests
cargo test

# 2. Integration tests
cargo test --test '*'

# 3. Regression test for THIS bug
cargo test [specific_test]

# 4. Smoke tests (all platforms if possible)
cargo build --release
./target/release/caro --version
./target/release/caro "list all files"
./target/release/caro "find files modified today"
[... test affected functionality ...]

# 5. Install script test
bash install.sh
~/.local/bin/caro --version
```

**Step 9: Version Bump and Commit** (5 min)
```bash
# Bump to v1.1.1
sed -i '' 's/version = "1.1.0"/version = "1.1.1"/' Cargo.toml
cargo build --release  # Regenerates Cargo.lock

sed -i '' 's/const VERSION: &str = "1.1.0"/const VERSION: &str = "1.1.1"/' src/version.rs

# Update CHANGELOG
cat > CHANGELOG_ENTRY.md <<'EOF'
## [1.1.1] - 2026-XX-XX

### Fixed
- **CRITICAL**: [Description of P0 bug fix] (fixes #XXX)

This is a hotfix release addressing a critical bug in v1.1.0.

EOF

cat CHANGELOG_ENTRY.md CHANGELOG.md > CHANGELOG_NEW.md
mv CHANGELOG_NEW.md CHANGELOG.md
rm CHANGELOG_ENTRY.md

# Commit fix
git add .
git commit -m "fix(critical): Fix P0 bug [description]

Fixes #XXX

This hotfix addresses a critical issue in v1.1.0 where [description].

Root cause: [brief explanation]
Fix: [brief explanation]
Testing: Added regression test [test_name]

Impact: Affects all users on v1.1.0"

git push origin hotfix/v1.1.1
```

---

### Hotfix Release (< 2 hours)

**Step 10: Tag and Build** (30 min)
```bash
# Tag the hotfix
git tag -a v1.1.1 -m "Hotfix release v1.1.1

Critical fix for v1.1.0 issue #XXX: [Description]

Changes:
- fix: [Description]
- test: Add regression test for #XXX

All v1.1.0 users should upgrade immediately."

git push origin v1.1.1

# Build release binaries
cargo clean
cargo build --release --locked

# Verify version
./target/release/caro --version
# Expected: caro 1.1.1

# Test critical functionality
./target/release/caro "list all files"
./target/release/caro "[the query that failed in v1.1.0]"
# Expected: Works correctly
```

**Step 11: Publish to crates.io** (10 min)
```bash
# Dry run
cargo publish --dry-run

# Publish (IRREVERSIBLE - only proceed if confident)
cargo publish

# Verify
sleep 60
cargo search caro
# Expected: caro = "1.1.1"
```

**Step 12: Create GitHub Release** (20 min)
```bash
gh release create v1.1.1 \
  --title "v1.1.1 - Critical Hotfix for v1.1.0" \
  --notes "## üö® Critical Hotfix

This release fixes a critical bug in v1.1.0: [Description]

**All v1.1.0 users should upgrade immediately.**

### Fixed
- **CRITICAL**: [Description] (fixes #XXX)

### Upgrade Instructions

**From v1.1.0**:
\`\`\`bash
cargo install caro --force
# or
curl -fsSL https://caro.sh/install.sh | bash
\`\`\`

**Fresh Install**:
\`\`\`bash
cargo install caro
\`\`\`

### Details

**Root Cause**: [Brief explanation]
**Fix**: [Brief explanation]
**Testing**: Added regression test to prevent recurrence

See [full changelog](https://github.com/your-org/caro/blob/main/CHANGELOG.md)" \
  --target v1.1.1 \
  target/release/caro-*
```

**Step 13: Update Documentation** (10 min)
```bash
# Remove v1.1.0 warnings from README
git checkout main
git pull origin main

# Remove alert banner
sed -i '' '/^> üö® \*\*CRITICAL ISSUE IN v1.1.0\*\*/,/^---$/d' README.md

# Add note about hotfix
sed -i '' 's/v1.1.0/v1.1.1/g' README.md

git commit -am "docs: Update for v1.1.1 hotfix release"
git push origin main
```

**Step 14: Announce Hotfix** (20 min)

**GitHub Discussions**:
```bash
gh discussion create \
  --category "Announcements" \
  --title "üö® v1.1.1 Critical Hotfix Released" \
  --body "A critical bug was found in v1.1.0: [Description]

**v1.1.1 is now available with the fix.**

All v1.1.0 users should upgrade immediately:
\`\`\`bash
cargo install caro --force
\`\`\`

Details: [Release notes link]
Issue: #XXX

We apologize for the inconvenience and appreciate your patience."
```

**Social Media**:
```
üö® Critical hotfix: caro v1.1.1 released

Fixes P0 bug in v1.1.0: [Brief description]

All v1.1.0 users: upgrade immediately
‚Üí cargo install caro --force

Details: [link]

Sorry for the trouble! üôè
```

**Step 15: Merge Hotfix to Main** (10 min)
```bash
gh pr create \
  --base main \
  --head hotfix/v1.1.1 \
  --title "Hotfix: v1.1.1 (fixes #XXX)" \
  --body "Critical hotfix for v1.1.0 P0 bug.

**Changes**:
- fix: [Description]
- test: Regression test for #XXX

**Testing**:
- ‚úÖ All unit tests passing
- ‚úÖ Regression test added and passing
- ‚úÖ Smoke tests on all platforms
- ‚úÖ Published to crates.io
- ‚úÖ GitHub release created

Closes #XXX"

gh pr merge --squash --delete-branch
```

---

### Post-Hotfix Monitoring (48 hours)

**Step 16: Monitor Adoption** (ongoing)
```bash
# Track v1.1.1 downloads
gh release view v1.1.1

# Monitor for new issues
gh issue list --label "v1.1.1" --state open

# Check telemetry for version distribution
# (if telemetry includes version field)
curl -s https://telemetry.caro.sh/stats | jq '.version_distribution'
```

**Step 17: Verify Fix** (24 hours after release)
```bash
# Check that no new reports of the bug
gh issue list --label "P0" --state open
# Expected: Original issue closed, no new instances

# Check user feedback
# - GitHub Discussions comments
# - Social media replies
# - Direct messages

# Success criteria:
# ‚úÖ No new reports of original P0 bug
# ‚úÖ No new P0 bugs introduced by hotfix
# ‚úÖ v1.1.1 download count increasing
# ‚úÖ Positive user feedback
```

---

## üî¥ Scenario 2: Privacy/Security Breach

**Definition**: PII collected in telemetry OR security vulnerability discovered

**Examples**:
- File paths containing usernames in telemetry
- Actual command strings (not just query strings) collected
- API keys in logs
- Exploitable vulnerability (RCE, privilege escalation)

### Immediate Actions (< 30 minutes)

**Step 1: STOP Data Collection** (5 min)
```bash
# If telemetry backend affected:

# Option A: Shut down backend immediately
# (depends on your infrastructure)
terraform destroy -target=module.telemetry

# Option B: Update backend to reject all uploads
# Add validation that rejects all events temporarily

# Option C: DNS redirect to maintenance page
# Update DNS to point telemetry.caro.sh to maintenance page
```

**Step 2: Assess Scope** (10 min)
```bash
# How much data affected?
cd /var/telemetry/data/
find . -name "*.json" -mtime -30 | wc -l
# Count files from last 30 days

# What PII was collected?
find . -name "*.json" -exec jq '.events[] | select(.command != null or .query != null)' {} \; | head -20
# Sample recent events

# Scan for specific PII types
grep -r "command" .  # Should be ZERO occurrences
grep -r "/home/" .   # Should be ZERO occurrences
grep -r "@" .        # Should be ZERO occurrences (emails)
grep -r "sk-" .      # Should be ZERO occurrences (API keys)
```

**Step 3: Create CRITICAL GitHub Issue** (5 min)
```bash
gh issue create \
  --label "CRITICAL" \
  --label "security" \
  --label "privacy" \
  --title "CRITICAL: PII/Security Breach in v1.1.0" \
  --body "**SECURITY/PRIVACY BREACH**

**Type**: [PII collection / Security vulnerability]
**Affected Versions**: v1.1.0
**Scope**: [Description of what was collected/vulnerability]
**First Discovered**: [Date/time]
**Data Exposure**: [How much, for how long]

**Immediate Actions Taken**:
- [ ] Telemetry backend shut down
- [ ] Data collection stopped
- [ ] Incident response team notified

**Next Steps**:
1. Data deletion/anonymization
2. User notification
3. Fix development
4. Security audit"
```

**Step 4: Notify Leadership** (5 min)
```
üö® SECURITY/PRIVACY INCIDENT - v1.1.0

Type: [PII collection / Security vulnerability]
Severity: CRITICAL
Impact: [Description]

Actions taken (last 30 min):
- Telemetry collection STOPPED
- Data assessed: [findings]
- GitHub issue created: #XXX

Next steps:
- User notification (required by privacy policy)
- Data deletion/anonymization
- Emergency hotfix
- Security audit

Incident response team activated.
```

**Step 5: Notify Users** (5 min)
```bash
# Update GitHub release IMMEDIATELY
gh release edit v1.1.0 --notes "$(cat <<'EOF'
üö® **SECURITY/PRIVACY INCIDENT**

v1.1.0 has been RETIRED due to a security/privacy issue.

**DO NOT USE v1.1.0**

[Brief description of issue]
[What data was affected]
[What we're doing about it]

A fixed version will be released within 24 hours.

We sincerely apologize for this incident.

Details: Issue #XXX

---

[Original release notes...]
EOF
)"

# Update README
git checkout main
sed -i '1i\> üö® **SECURITY ALERT**: v1.1.0 retired due to privacy/security issue. Details: #XXX. Fixed version coming within 24 hours.\n' README.md
git commit -am "SECURITY: Alert for v1.1.0 privacy/security issue"
git push origin main
```

---

### Data Remediation (< 4 hours)

**Step 6: Delete/Anonymize Affected Data** (depends on scope)
```bash
# If telemetry data affected:

cd /var/telemetry/data/

# Backup FIRST (for forensics)
tar czf backup-before-deletion-$(date +%Y%m%d).tar.gz .

# Option A: Complete deletion (if all data tainted)
rm -rf *.json

# Option B: Selective deletion (if specific fields affected)
for file in *.json; do
  jq 'del(.events[].command, .events[].query)' "$file" > "$file.clean"
  mv "$file.clean" "$file"
done

# Verify deletion
grep -r "command" .  # Expected: ZERO results
grep -r "/home/" .   # Expected: ZERO results

# Document what was deleted
cat > DELETION_LOG.md <<EOF
**Data Deletion Log**

Date: $(date)
Reason: Privacy incident #XXX
Scope: [Description]
Files Affected: [Count]
Data Deleted: [Specific fields/files]
Verification: [How we confirmed deletion]
Backup Location: backup-before-deletion-$(date +%Y%m%d).tar.gz

Performed by: [Name]
Approved by: [Name]
EOF
```

**Step 7: Notify Affected Users** (if identifiable)
```bash
# If you can identify affected users (e.g., from session IDs -> GitHub usernames):

# Template email:
cat > privacy-notification-email.txt <<'EOF'
Subject: Important Privacy Notice - caro v1.1.0

Dear caro user,

We are writing to inform you of a privacy incident affecting caro v1.1.0.

**What Happened**
[Brief, clear description of what data was collected]

**What Data Was Affected**
[Specific description of what PII was collected]

**What We've Done**
1. Immediately stopped data collection (within 30 minutes of discovery)
2. Deleted all affected data from our systems
3. Verified deletion through multiple checks
4. Developed a fix to prevent recurrence

**What You Should Do**
1. If you have v1.1.0 installed, we recommend:
   - Clearing local telemetry: `caro telemetry clear`
   - Waiting for v1.1.1 before upgrading
2. If you have concerns, please contact us at: security@caro.sh

**Our Commitment**
We take privacy extremely seriously. This incident resulted from [brief root cause], which we have now addressed with [brief fix description].

We sincerely apologize for this incident and any concern it may cause.

Transparency report: [link to detailed incident report]

Thank you for your understanding.

The caro Team
EOF

# Send via appropriate channel (email, GitHub notification, etc.)
```

---

### Emergency Fix (< 24 hours)

**Step 8: Develop Privacy/Security Fix**
```bash
git checkout -b hotfix/v1.1.1-security v1.1.0

# Fix the privacy/security issue
[... implement fix ...]

# Add comprehensive tests
[... add tests that verify PII is NOT collected ...]
[... add tests that verify security vulnerability is fixed ...]

# Update privacy validation
# For telemetry: strengthen privacy.rs regex patterns
# For security: add validation, input sanitization, etc.
```

**Step 9: Security Audit**
```bash
# Internal security review checklist:

# 1. Privacy validation comprehensive?
grep -r "validate_privacy" src/
# Verify all telemetry emission points go through validation

# 2. No command/query collection?
grep -r "command:" src/telemetry/
grep -r "query:" src/telemetry/
# Expected: ZERO occurrences in event structs

# 3. Session ID properly anonymized?
grep -r "session_id" src/telemetry/
# Verify: Uses hashed hostname + daily rotation

# 4. Security vulnerability mitigated?
[... specific checks for the vulnerability ...]

# 5. Comprehensive test coverage?
cargo test --test privacy
# Expected: 220+ tests, all passing
```

**Step 10: External Security Review** (if vulnerability severe)
```bash
# Consider external security audit for:
# - RCE vulnerabilities
# - Privilege escalation
# - Code execution bugs
# - Data exposure at scale

# Contact security@rust-lang.org for guidance
# Or hire professional security auditor
```

**Step 11: Release v1.1.1 with Security Fix**

Follow Scenario 1 Steps 9-15, with additional security notes:

```bash
# Tag message includes SECURITY
git tag -a v1.1.1 -m "SECURITY RELEASE v1.1.1

Critical security/privacy fix for v1.1.0 issue #XXX.

ALL v1.1.0 USERS MUST UPGRADE IMMEDIATELY.

Changes:
- SECURITY: [Description of fix]
- Privacy validation strengthened
- Comprehensive test coverage added

Security audit: Passed internal review
[+ External audit if applicable]"

# GitHub release includes SECURITY label
gh release create v1.1.1 \
  --title "v1.1.1 - SECURITY/PRIVACY HOTFIX" \
  --notes "## üö® CRITICAL SECURITY/PRIVACY FIX

This release fixes a critical security/privacy issue in v1.1.0.

**ALL v1.1.0 USERS MUST UPGRADE IMMEDIATELY.**

[... rest of release notes ...]"
```

---

### Post-Incident (7 days)

**Step 12: Transparency Report** (within 7 days)
```bash
# Create public incident report
cd .claude/releases/
cat > v1.1.0-security-incident-report.md <<'EOF'
# Security Incident Report: v1.1.0

**Date**: 2026-XX-XX
**Severity**: CRITICAL
**Type**: [Privacy breach / Security vulnerability]

## Incident Summary

[Clear, honest description of what happened]

## Timeline

- **T+0min**: Incident discovered
- **T+30min**: Data collection stopped
- **T+1hr**: Users notified
- **T+4hr**: Data deleted/anonymized
- **T+24hr**: Fix released (v1.1.1)
- **T+48hr**: Majority of users upgraded
- **T+7days**: This transparency report published

## What Data Was Affected

[Specific, detailed description]

## Root Cause

[Technical explanation of how this happened]

## Our Response

1. Immediate: [What we did in first 30 minutes]
2. Short-term: [What we did in first 24 hours]
3. Long-term: [What we're doing to prevent recurrence]

## Lessons Learned

[What we learned and how we're improving]

## Changes Made

- [Specific technical changes]
- [Process improvements]
- [Additional safeguards]

## Commitment Going Forward

[Our commitment to privacy/security]

## Questions?

security@caro.sh
EOF

# Publish to GitHub
git add v1.1.0-security-incident-report.md
git commit -m "docs(security): Publish v1.1.0 incident transparency report"
git push origin main

# Link from README
```

**Step 13: Post-Incident Retrospective**

See `v1.1.0-beta-retrospective-template.md` with additional focus on:
- How incident was detected
- Response time and effectiveness
- Process gaps that allowed incident
- Technical debt that contributed
- Training/awareness gaps
- External communication effectiveness

---

## üî¥ Scenario 3: Installation Failures

**Definition**: Users unable to install via install.sh or cargo install

**Examples**:
- install.sh downloads corrupted binary
- Binary missing for specific platform
- Cargo build fails due to dependency issue
- Permission errors during installation

### Immediate Actions (< 1 hour)

**Step 1: Confirm Scope** (15 min)
```bash
# Test installation on clean systems
# macOS:
docker run --rm -it --platform linux/amd64 homebrew/brew bash
curl -fsSL https://caro.sh/install.sh | bash
~/.local/bin/caro --version

# Ubuntu:
docker run --rm -it ubuntu:22.04 bash
apt-get update && apt-get install -y curl
curl -fsSL https://caro.sh/install.sh | bash
~/.local/bin/caro --version

# Fedora:
docker run --rm -it fedora:latest bash
dnf install -y curl
curl -fsSL https://caro.sh/install.sh | bash
~/.local/bin/caro --version

# Alpine (for musl):
docker run --rm -it alpine:latest sh
apk add --no-cache curl bash
curl -fsSL https://caro.sh/install.sh | bash
~/.local/bin/caro --version
```

**Step 2: Identify Root Cause** (15 min)

Common issues:
1. **Binary corrupted**: Check SHA256 checksums
2. **Binary missing**: Check GitHub release assets
3. **Wrong architecture**: Check platform detection in install.sh
4. **Permission issue**: Check file permissions
5. **Cargo build failure**: Check dependency compatibility

```bash
# Check GitHub release assets
gh release view v1.1.0
# Verify all binaries present

# Check binary integrity
cd /tmp
curl -LO https://github.com/your-org/caro/releases/download/v1.1.0/caro-linux-x86_64
sha256sum caro-linux-x86_64
# Compare with expected checksum

# Check install.sh logic
curl -fsSL https://caro.sh/install.sh | less
# Review platform detection, download URL construction
```

**Step 3: Quick Fix if Possible** (30 min)

If install.sh bug:
```bash
# Fix install.sh
git checkout main
# [fix the bug in install.sh]
git commit -am "fix(install): Fix installation on [platform]"
git push origin main

# Update install.sh on server (if you control it)
# Or rely on GitHub raw URL if that's the source
```

If binary missing/corrupted:
```bash
# Rebuild and re-upload binary
cargo clean
cargo build --release --target [affected-target]

# Test locally
./target/[affected-target]/release/caro --version

# Re-upload to GitHub release
gh release upload v1.1.0 ./target/[affected-target]/release/caro-[platform] --clobber
```

**Step 4: Add Temporary Workaround to README** (15 min)
```bash
# If fix will take > 1 hour
git checkout main

sed -i '1i\> ‚ö†Ô∏è **Installation Issue**: Some users experiencing install failures on [platform]. Workaround: [description]. Fix in progress.\n' README.md

git commit -am "docs: Add workaround for installation issue"
git push origin main
```

---

## üî¥ Scenario 4: Telemetry Backend Failure

**Definition**: Telemetry backend down, slow, or experiencing data loss

**Impact**: NOT user-blocking (caro continues working), but affects visibility and user experience

### Immediate Actions (< 30 minutes)

**Step 1: Assess Backend Health** (5 min)
```bash
# Check health endpoint
curl -v https://telemetry.caro.sh/health

# Check recent upload success rate (if metrics available)
curl https://telemetry.caro.sh/metrics | jq '.upload_success_rate'

# Check storage capacity
df -h /var/telemetry/data
```

**Step 2: Determine Severity** (5 min)

| Symptom | Severity | Action |
|---------|----------|--------|
| 503 errors, no uploads succeeding | P1 | Immediate fix required |
| Slow responses (> 10s) | P2 | Investigate, may need scaling |
| Intermittent 500 errors | P2 | Bug fix needed |
| Storage full | P1 | Clear space or scale storage |
| Data loss detected | P0 | STOP writes, investigate |

**Step 3: Immediate Mitigation** (20 min)

For P0/P1 issues:
```bash
# Option A: Failover to staging
# Update DNS or load balancer to point to staging

# Option B: Scale up resources
# (depends on infrastructure)
terraform apply -var="instance_count=3"

# Option C: Temporary disable
# Update README with notice
echo "Telemetry temporarily unavailable (backend maintenance)" >> TELEMETRY_STATUS.md
```

---

### Backend Recovery (< 4 hours)

**Step 4: Diagnose Root Cause**

Common issues:
1. **Storage full**: Clear old data or expand storage
2. **Memory exhaustion**: Restart service, investigate memory leak
3. **Database corruption**: Restore from backup
4. **DDoS/abuse**: Rate limiting needed
5. **Bug in backend code**: Deploy fix

**Step 5: Fix and Deploy**

(Steps depend on your backend architecture)

**Step 6: Verify Recovery**
```bash
# Test upload from clean install
cargo install caro --force
caro "list all files"
sleep 65  # Wait for batch upload

# Check logs/dashboard
# Expected: Upload successful

# Monitor for 1 hour
watch -n 300 'curl -s https://telemetry.caro.sh/stats | jq'
```

---

## üî¥ Scenario 5: Silent Data Corruption

**Definition**: Subtle bug that corrupts data or produces incorrect results without obvious errors

**Examples**:
- Commands generated but wrong (subtle logic error)
- Telemetry data recorded incorrectly
- Config file corruption on certain platforms

### Immediate Actions (< 2 hours)

**Step 1: Confirm Corruption** (30 min)
```bash
# Reproduce the issue
[... steps ...]

# Assess scope
# How many users affected?
# How long has this been happening?
# What data is corrupted?

# Check telemetry for anomalies
curl https://telemetry.caro.sh/stats | jq '.error_patterns'
```

**Step 2: Document Thoroughly** (30 min)
```bash
# Create detailed GitHub issue
gh issue create \
  --label "P0" \
  --label "data-corruption" \
  --title "P0: Silent data corruption in [component]" \
  --body "**Corruption Type**: [Description]
**Affected Data**: [What data]
**Scope**: [How many users, how long]
**Reproduction**:
1. [Step 1]
2. [Step 2]
**Expected Data**: [...]
**Actual Data**: [...]

**Evidence**:
- [Link to telemetry showing anomaly]
- [Screenshot/log of corrupted output]

**Hypothesis**: [Initial theory of root cause]"
```

**Step 3: Assess Impact and Decide** (30 min)

| Corruption Severity | User Impact | Action |
|---------------------|-------------|--------|
| Subtle, rare edge case | Low | Plan v1.1.1 fix |
| Affects 10-20% of queries | Medium | Hotfix within 48 hours |
| Affects majority of queries | High | Emergency hotfix within 24 hours |
| Security/safety implications | Critical | Immediate hotfix |

**Step 4: Communicate if Needed** (30 min)

If HIGH or CRITICAL:
- Update GitHub release with warning
- Update README with notice
- Post in GitHub Discussions
- Consider user notification

If MEDIUM:
- Create GitHub issue
- Plan v1.1.1
- Document in known issues

---

### Data Corruption Fix

Follow Scenario 1 hotfix process with additional steps:

1. **Root cause analysis**: Why did corruption occur undetected?
2. **Add detection**: How can we detect this corruption automatically?
3. **Add validation**: What validation should prevent this?
4. **Data recovery**: Can we help users recover corrupted data?

---

## Emergency Contacts

**On-Call Engineer**: [Name] - [Contact]
**Release Manager**: [Name] - [Contact]
**Engineering Lead**: [Name] - [Contact]
**Security Contact**: security@caro.sh

**Escalation Path**:
1. On-Call Engineer (first responder)
2. Release Manager (within 30 min if P0)
3. Engineering Lead (within 1 hour if unresolved)

---

## Post-Incident Checklist

After ANY emergency scenario:

- [ ] Root cause documented
- [ ] Fix verified working
- [ ] Users notified (if needed)
- [ ] Telemetry/monitoring updated to detect earlier
- [ ] Tests added to prevent regression
- [ ] Retrospective scheduled (within 7 days)
- [ ] Process improvements identified
- [ ] Documentation updated
- [ ] Transparency report published (if user-facing)

---

**Last Updated**: 2026-01-08
**Version**: 1.0
