# v1.1.0 Hotfix Protocol

**Purpose**: Emergency patch procedure for critical bugs during/after v1.1.0-beta release
**Audience**: Engineering Team, Release Manager
**Scope**: P0/P1 bugs requiring immediate fixes
**Timeline**: 2-8 hours from discovery to release

---

## When to Use This Protocol

### Hotfix Triggers

Use this protocol when **ANY** of these conditions occur:

1. **P0 Bug Discovered** üö® CRITICAL
   - Complete functionality failure
   - Data corruption risk
   - Security vulnerability
   - Privacy breach (PII collected)
   - Installation completely broken

2. **P1 Bug Affecting Majority of Users**
   - Major feature broken for most users
   - Significant degradation of core functionality
   - Platform-specific critical failure

3. **Emergency Mitigation Required**
   - Immediate action needed within hours
   - Cannot wait for next planned release
   - User impact is severe and widespread

### When NOT to Use

**Do not use hotfix protocol for**:
- P2/P3 bugs (wait for next release)
- Feature requests
- Performance optimizations (unless critical)
- Documentation fixes
- Single-user edge cases

**Rationale**: Hotfixes bypass normal testing. Only use for genuine emergencies.

---

## Severity Classification

### P0: Critical - Immediate Hotfix (< 4 hours)

**Examples**:
- `caro` crashes on launch for all users
- PII collected in telemetry (PRIVACY BREACH)
- Command generation returns destructive commands
- Installation script deletes user files
- Security vulnerability allowing code execution

**Impact**: Affects ALL or MOST users, causes severe harm
**Response Time**: Within 1 hour of discovery
**Release Target**: Within 4 hours

### P1: High - Urgent Hotfix (< 24 hours)

**Examples**:
- Major feature completely broken (e.g., embedded backend doesn't work)
- Platform-specific crash (e.g., segfault on Linux only)
- Telemetry upload causes errors
- Command generation quality catastrophically low (<50% pass rate)

**Impact**: Affects significant user subset, major inconvenience
**Response Time**: Within 4 hours of discovery
**Release Target**: Within 24 hours

### P2: Medium - Next Release

**Examples**:
- Minor feature bug
- Cosmetic issues
- Edge case failures
- Performance degradation (non-critical)

**Impact**: Affects few users, workaround exists
**Response**: Fix in next planned release (v1.1.1)

---

## Hotfix Workflow

### Phase 1: Discovery & Assessment (0-30 min)

**1. Bug Report Received**

- [ ] **Verify the bug** (5 min)
  ```bash
  # Reproduce locally
  caro <failing_command>

  # Check multiple platforms if platform-specific
  # Check logs for error details
  ```

- [ ] **Assess severity** (5 min)
  - How many users affected? All / Most / Some / Few
  - What's the impact? Unusable / Major / Minor
  - Is there a workaround? Yes / No
  - **Decision**: P0 / P1 / P2

- [ ] **Create GitHub issue** (5 min)
  ```markdown
  Title: [P0] Brief description

  **Severity**: P0 (or P1)
  **Impact**: X% of users, <specific impact>
  **Discovered**: <timestamp>
  **Platform**: All / macOS / Linux / Windows
  **Version**: v1.1.0-beta

  ## Reproduction
  1. Step 1
  2. Step 2

  ## Expected
  <what should happen>

  ## Actual
  <what happens>

  ## Logs
  ```
  <paste logs>
  ```
  ```

- [ ] **Notify team** (5 min)
  ```
  Subject: üö® P0 BUG: <brief description>

  Severity: P0
  Impact: <user impact>
  Issue: #XXX

  Action: Hotfix required within 4 hours
  Assignee: <who's driving?>
  ```

- [ ] **Decide: Hotfix or Next Release?** (10 min)
  - **IF P0**: Proceed with hotfix immediately
  - **IF P1**: Assess urgency, likely hotfix
  - **IF P2**: Add to v1.1.1 backlog, STOP here

---

### Phase 2: Root Cause Analysis (30-60 min)

**Goal**: Understand WHY the bug exists before fixing

- [ ] **Investigate root cause** (30 min)
  - Which component is failing?
  - What changed recently? (git log, blame)
  - Is this a regression? (did it work before?)
  - Platform-specific or universal?

- [ ] **Document findings** (10 min)
  ```markdown
  ## Root Cause

  **Component**: <which file/module>
  **Introduced In**: <commit hash or "unknown">
  **Cause**: <technical explanation>

  ## Why It Wasn't Caught
  - <test gap>
  - <review oversight>
  ```

- [ ] **Design fix** (20 min)
  - What's the minimal fix?
  - What's the safest fix?
  - Are there side effects?
  - Will this break other functionality?

- [ ] **Review fix design with team**
  - Get approval from at least one other engineer
  - Ensure fix is minimal and safe
  - Document any trade-offs

---

### Phase 3: Fix Implementation (1-2 hours)

**Critical Rule**: Keep changes MINIMAL - only fix the specific bug

- [ ] **Create hotfix branch** (2 min)
  ```bash
  # From the release tag
  git checkout v1.1.0-beta
  git checkout -b hotfix/v1.1.0-beta.1
  ```

- [ ] **Implement fix** (60 min)
  ```bash
  # Edit relevant files
  # Keep changes minimal and focused
  ```

- [ ] **Write regression test** (30 min)
  ```rust
  #[test]
  fn test_bug_xxx_does_not_occur() {
      // Reproduce the bug condition
      let result = trigger_bug_scenario();

      // Verify it's fixed
      assert!(result.is_ok());
      assert_eq!(expected_behavior, actual_behavior);
  }
  ```

- [ ] **Run full test suite** (10 min)
  ```bash
  cargo test
  # ALL tests must pass
  ```

- [ ] **Manual verification** (10 min)
  ```bash
  cargo build --release
  ./target/release/caro <previously failing command>
  # Verify fix works
  ```

- [ ] **Commit fix** (2 min)
  ```bash
  git add <files>
  git commit -m "fix(critical): <brief description>

Fixes #XXX

Root Cause: <one sentence>
Impact: <user impact>
Fix: <what changed>

Tested:
- Unit tests: PASS
- Manual verification: PASS
- Regression test added: YES"
  ```

---

### Phase 4: Testing & Verification (1-2 hours)

**Goal**: Ensure fix works AND doesn't break anything else

- [ ] **Local testing** (30 min)
  - [ ] Run full test suite: `cargo test`
  - [ ] Build release binary: `cargo build --release`
  - [ ] Test the specific bug scenario (10 variations)
  - [ ] Test related functionality (regression check)

- [ ] **Platform testing** (30 min)
  - [ ] Test on macOS (if bug was platform-agnostic)
  - [ ] Test on Linux VM
  - [ ] Test on clean system (not dev environment)

- [ ] **Beta tester verification** (IF P0 during beta) (30 min)
  - Send hotfix binary to 1-2 beta testers
  - Ask them to verify fix works
  - Collect quick feedback (< 30 min turnaround)

- [ ] **Privacy audit** (IF telemetry-related) (30 min)
  - [ ] Manual review: ZERO PII check
  - [ ] Run privacy tests
  - [ ] Review all telemetry events
  - **BLOCKER**: Any PII = no release

- [ ] **Final verification checklist**
  - [ ] Bug is fixed: YES / NO
  - [ ] No regressions introduced: YES / NO
  - [ ] All tests pass: YES / NO
  - [ ] Manual testing successful: YES / NO
  - [ ] Platform-specific testing done: YES / NO (if applicable)

---

### Phase 5: Release Preparation (30-60 min)

**Goal**: Prepare hotfix for public release

- [ ] **Version bump** (5 min)
  ```bash
  # v1.1.0-beta ‚Üí v1.1.0-beta.1 (first hotfix)
  # v1.1.0-beta.1 ‚Üí v1.1.0-beta.2 (second hotfix)

  sed -i '' 's/version = "1.1.0-beta"/version = "1.1.0-beta.1"/' Cargo.toml
  cargo build --release  # Regenerate Cargo.lock

  sed -i '' 's/const VERSION: &str = "1.1.0-beta"/const VERSION: &str = "1.1.0-beta.1"/' src/version.rs
  ```

- [ ] **Update CHANGELOG.md** (10 min)
  ```markdown
  ## [1.1.0-beta.1] - 2026-01-XX - HOTFIX

  ### Fixed
  - **CRITICAL**: <bug description> (#XXX)
    - Impact: <who was affected>
    - Root cause: <technical summary>
    - Fix: <what changed>

  **Recommendation**: All v1.1.0-beta users should upgrade immediately.
  ```

- [ ] **Prepare release notes** (15 min)
  ```markdown
  # v1.1.0-beta.1 - Critical Hotfix

  ## üö® Critical Bug Fix

  This hotfix addresses a critical bug in v1.1.0-beta:

  **Issue**: <user-facing description>
  **Impact**: <who's affected>
  **Fix**: <what we did>

  ## Should I Upgrade?

  **YES** if you're using v1.1.0-beta and <condition>.

  ## Installation

  ```bash
  cargo install caro --version 1.1.0-beta.1
  ```

  ## What Changed

  - Fixed: <specific change>
  - Tested: <verification done>

  ## Technical Details

  See issue #XXX for full technical details.

  ## Thank You

  Thanks to @<reporter> for discovering and reporting this issue.
  ```

- [ ] **Commit version bump** (2 min)
  ```bash
  git add Cargo.toml Cargo.lock CHANGELOG.md src/version.rs
  git commit -m "chore: Bump version to v1.1.0-beta.1"
  ```

- [ ] **Final smoke test** (10 min)
  ```bash
  cargo clean
  cargo build --release
  ./target/release/caro --version  # Should show v1.1.0-beta.1
  ./target/release/caro <test commands>
  ```

---

### Phase 6: Deployment (30-60 min)

**Goal**: Publish hotfix to users ASAP

- [ ] **Create git tag** (2 min)
  ```bash
  git tag -a v1.1.0-beta.1 -m "Hotfix: <brief description> (#XXX)"
  git push origin hotfix/v1.1.0-beta.1
  git push origin v1.1.0-beta.1
  ```

- [ ] **Publish to crates.io** (5 min) üö® IRREVERSIBLE
  ```bash
  cargo publish --dry-run
  # Review output carefully

  cargo publish
  # Wait for confirmation
  ```

- [ ] **Create GitHub release** (10 min)
  ```bash
  gh release create v1.1.0-beta.1 \
    --title "v1.1.0-beta.1 - Critical Hotfix" \
    --notes-file HOTFIX_NOTES.md \
    --prerelease
  ```

- [ ] **Verify publication** (5 min)
  ```bash
  # Check crates.io
  open https://crates.io/crates/caro

  # Verify version shows 1.1.0-beta.1

  # Test installation
  cargo install caro --version 1.1.0-beta.1 --force
  caro --version
  ```

---

### Phase 7: Communication (30-60 min)

**Goal**: Notify ALL users about critical fix

**Immediate Communication (P0 only)** - Within 30 minutes of release

- [ ] **Email to beta testers** (10 min) ‚è∞ TIME-SENSITIVE
  ```
  Subject: üö® CRITICAL HOTFIX: v1.1.0-beta.1 Released

  Hi beta testers,

  We've just released v1.1.0-beta.1 to fix a critical bug:

  **Issue**: <user-facing description>
  **Impact**: <who's affected>
  **Action Required**: Upgrade immediately

  ## How to Upgrade

  ```bash
  cargo install caro --version 1.1.0-beta.1 --force
  ```

  ## What Changed

  <brief technical summary>

  ## Verification

  After upgrading, verify:
  - Version: `caro --version` shows 1.1.0-beta.1
  - Test: <specific command to verify fix>

  ## Thank You

  Thanks for your patience. If you encounter any issues with this
  hotfix, please let us know immediately.

  Best,
  [Release Manager]
  ```

- [ ] **GitHub Discussions post** (10 min)
  ```markdown
  Title: üö® v1.1.0-beta.1 Hotfix Released

  ## Critical Bug Fix

  We've released v1.1.0-beta.1 to address a critical issue in v1.1.0-beta.

  **Issue**: <description>
  **Recommendation**: All v1.1.0-beta users should upgrade immediately.

  ## Installation

  ```bash
  cargo install caro --version 1.1.0-beta.1 --force
  ```

  ## Details

  See [Release Notes](https://github.com/.../releases/tag/v1.1.0-beta.1)
  Issue: #XXX

  Thank you to @<reporter> for the bug report!
  ```

- [ ] **Social media** (IF P0) (10 min)
  ```
  üö® Hotfix alert: caro v1.1.0-beta.1 released to fix critical bug.

  If you're using v1.1.0-beta, please upgrade:
  cargo install caro --version 1.1.0-beta.1 --force

  Details: <GitHub release URL>
  ```

**Follow-up Communication (24 hours later)**

- [ ] **Check upgrade adoption**
  - Monitor telemetry for version distribution
  - Identify users still on old version
  - Send reminder emails if needed

- [ ] **Post-mortem notice** (IF P0)
  ```
  Subject: Post-Mortem: v1.1.0-beta Bug #XXX

  We've completed our analysis of the critical bug fixed in
  v1.1.0-beta.1. Here's what we learned:

  ## What Happened
  <summary>

  ## Root Cause
  <technical details>

  ## Why It Wasn't Caught
  <testing gap>

  ## Prevention Measures
  - <new test added>
  - <process improvement>

  Thank you for your understanding and quick response.
  ```

---

### Phase 8: Post-Release Monitoring (24-48 hours)

**Goal**: Ensure hotfix solved problem without introducing new ones

- [ ] **Monitor for new issues** (24 hours)
  - Check GitHub issues every 4 hours
  - Monitor telemetry for errors
  - Track social media mentions
  - Respond to questions within 1 hour

- [ ] **Verify fix effectiveness** (24 hours)
  - Confirm bug reports stopped
  - Check telemetry: error rate decreased
  - Beta tester feedback: positive?

- [ ] **Watch for regressions** (48 hours)
  - New bugs introduced by fix?
  - Performance degradation?
  - Platform-specific issues?

- [ ] **Adoption tracking**
  - % of users on v1.1.0-beta.1: ____ %
  - Target: 80%+ within 48 hours
  - Action if low: Send reminders

---

## Hotfix Decision Matrix

| Bug Severity | User Impact | Response Time | Testing Depth | Communication |
|--------------|-------------|---------------|---------------|---------------|
| P0 - Critical | ALL users | < 4 hours | Minimal (focus on fix) | Immediate, all channels |
| P1 - High | MOST users | < 24 hours | Standard testing | Email + GitHub |
| P2 - Medium | SOME users | Next release | Full testing | Release notes only |
| P3 - Low | FEW users | Backlog | Full testing | None |

---

## Common Scenarios

### Scenario 1: Privacy Breach (PII Collected)

**This is the HIGHEST priority emergency**

**Immediate Actions** (< 15 minutes):
1. [ ] **STOP ALL TELEMETRY IMMEDIATELY**
   - Emergency fix: Disable telemetry in next commit
   - Or: Emergency backend shutdown
2. [ ] **Notify ALL users within 15 minutes**
3. [ ] **Delete all collected telemetry data**
4. [ ] **Investigate validation failure**
5. [ ] **External security audit** (if PII was transmitted)

**Hotfix Priority**: P0 - Immediate
**Timeline**: Within 2 hours
**Communication**: Transparent disclosure required

---

### Scenario 2: Command Generation Returns Destructive Commands

**Examples**:
- `caro "list files"` returns `rm -rf /`
- Safety validation completely bypassed

**Immediate Actions** (< 30 minutes):
1. [ ] **Verify the report** (test immediately)
2. [ ] **Assess scope**: Which backends affected?
3. [ ] **Emergency mitigation**:
   - Option A: Disable unsafe commands via hotfix
   - Option B: Add emergency safety checks
4. [ ] **Notify users to STOP using until patched**

**Hotfix Priority**: P0 - Immediate
**Timeline**: Within 4 hours
**Communication**: Urgent warning + hotfix announcement

---

### Scenario 3: Crash on Launch (All Platforms)

**Examples**:
- Segfault on startup
- Panic before command can run

**Immediate Actions** (< 30 minutes):
1. [ ] **Get stack trace from reporter**
2. [ ] **Reproduce locally**
3. [ ] **Identify breaking change** (recent commit?)
4. [ ] **Quick fix or rollback?**
   - If quick fix possible: Implement in hotfix
   - If complex: Consider advising users to downgrade

**Hotfix Priority**: P0 - Immediate
**Timeline**: Within 4 hours
**Communication**: Immediate notification + workaround

---

### Scenario 4: Platform-Specific Critical Bug (Linux Only)

**Examples**:
- Segfault on Linux but works on macOS
- Binary won't run on certain distros

**Immediate Actions** (< 1 hour):
1. [ ] **Reproduce on affected platform**
2. [ ] **Assess user impact**: What % of users?
3. [ ] **Platform-specific fix** (likely in dependencies or flags)
4. [ ] **Test on multiple Linux distros**

**Hotfix Priority**: P1 - Urgent
**Timeline**: Within 24 hours
**Communication**: GitHub issue + targeted email to affected users

---

### Scenario 5: Embedded Backend Completely Broken

**Examples**:
- Model fails to load
- All LLM queries return errors
- Embedded backend panics

**Immediate Actions** (< 1 hour):
1. [ ] **Assess fallback**: Does static matcher still work?
2. [ ] **Scope of breakage**: All queries or specific types?
3. [ ] **Quick fix feasible?**
   - Model loading issue: Fix path/permissions
   - Inference error: Prompt or config issue
4. [ ] **Workaround**: Document using static matcher only

**Hotfix Priority**: P1 - Urgent (since static matcher provides fallback)
**Timeline**: Within 24 hours
**Communication**: Email to beta testers + GitHub issue

---

## Testing Requirements by Severity

### P0 Hotfix Testing (Minimal - < 2 hours)

**Required**:
- [ ] Unit tests for the specific fix
- [ ] Manual reproduction of bug (verify fix works)
- [ ] Basic smoke test (app launches, core commands work)
- [ ] Platform-specific testing (if platform bug)

**Optional** (skip if time-critical):
- Full regression testing (do post-release)
- Performance testing
- UI/UX testing

**Rationale**: Speed is critical for P0. Focus on the specific bug.

---

### P1 Hotfix Testing (Standard - < 8 hours)

**Required**:
- [ ] All P0 requirements above
- [ ] Full test suite: `cargo test`
- [ ] Regression testing of related functionality
- [ ] Multi-platform testing (macOS + Linux)
- [ ] Beta tester verification (1-2 testers)

**Optional**:
- Extensive edge case testing (do post-release)

**Rationale**: P1 allows more time for thorough testing.

---

## Emergency Contacts

### During Beta Testing (Jan 13-24)

**Release Manager**: [Name] - [Email] - [Phone]
**Lead Engineer**: [Name] - [Email] - [Phone]
**Backup Engineer**: [Name] - [Email] - [Phone]

**Escalation Path**:
1. Report to Release Manager (preferred)
2. If unavailable: Lead Engineer
3. If both unavailable: Backup Engineer
4. Emergency: [Emergency contact]

---

## Post-Hotfix Review

**Within 48 hours of hotfix release, conduct retrospective**:

### Questions to Answer

1. **Detection**: How was the bug discovered?
   - User report / Telemetry / Internal testing

2. **Response**: How quickly did we respond?
   - Time to acknowledge: ____ minutes
   - Time to fix: ____ hours
   - Time to release: ____ hours

3. **Root Cause**: Why did the bug occur?
   - Technical reason: _____
   - Why wasn't it caught in testing? _____

4. **Prevention**: How do we prevent similar bugs?
   - New test added: YES / NO
   - Process change: _____
   - Code review improvement: _____

5. **Communication**: How well did we communicate?
   - User feedback: _____
   - Clarity of messages: _____
   - Response time to questions: _____

### Document Lessons Learned

- [ ] Update test suite with regression test
- [ ] Add to pre-flight checklist (if applicable)
- [ ] Update this hotfix protocol (if process gaps found)
- [ ] Share learnings with team

---

## Hotfix Checklist Summary

**Quick Reference** - Check off as you go:

**Phase 1: Discovery (30 min)**
- [ ] Verify bug
- [ ] Assess severity (P0/P1/P2)
- [ ] Create GitHub issue
- [ ] Notify team
- [ ] Decide: Hotfix or next release?

**Phase 2: Analysis (60 min)**
- [ ] Root cause analysis
- [ ] Document findings
- [ ] Design fix
- [ ] Get team approval

**Phase 3: Implementation (2 hours)**
- [ ] Create hotfix branch
- [ ] Implement minimal fix
- [ ] Write regression test
- [ ] Run full test suite
- [ ] Manual verification
- [ ] Commit fix

**Phase 4: Testing (2 hours)**
- [ ] Local testing
- [ ] Platform testing
- [ ] Beta tester verification (if needed)
- [ ] Privacy audit (if telemetry)
- [ ] Final verification

**Phase 5: Preparation (60 min)**
- [ ] Version bump
- [ ] Update CHANGELOG
- [ ] Prepare release notes
- [ ] Final smoke test

**Phase 6: Deployment (60 min)**
- [ ] Create git tag
- [ ] Publish to crates.io
- [ ] Create GitHub release
- [ ] Verify publication

**Phase 7: Communication (60 min)**
- [ ] Email beta testers
- [ ] GitHub Discussions post
- [ ] Social media (if P0)
- [ ] Follow-up (24h later)

**Phase 8: Monitoring (48 hours)**
- [ ] Monitor for new issues
- [ ] Verify fix effectiveness
- [ ] Watch for regressions
- [ ] Track adoption

**Total Timeline**:
- **P0 Hotfix**: 4-6 hours (discovery to release)
- **P1 Hotfix**: 12-24 hours (discovery to release)

---

## Success Criteria

A hotfix is successful when:

1. ‚úÖ **Bug is fixed**: Original issue no longer reproducible
2. ‚úÖ **No regressions**: No new bugs introduced
3. ‚úÖ **Users notified**: All affected users aware of fix
4. ‚úÖ **Adoption high**: 80%+ upgraded within 48 hours
5. ‚úÖ **Stability maintained**: No new P0/P1 issues
6. ‚úÖ **Prevention measures**: Regression test added, process improved

---

**Document Status**: Complete and ready for use during beta/release
**Next Review**: After first hotfix (update with lessons learned)
**Maintenance**: Update after each hotfix to improve process
