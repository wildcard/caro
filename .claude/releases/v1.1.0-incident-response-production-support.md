# Incident Response and Production Support - v1.1.0-beta

**Document Version**: 1.0
**Last Updated**: 2026-01-08
**Status**: Pre-Launch
**Owner**: Engineering Lead / On-Call Engineer

---

## Overview

This document establishes incident response procedures, production support guidelines, on-call rotation, escalation paths, and post-incident review processes for Caro v1.1.0-beta.

### Goals

- **Fast Response**: Acknowledge critical issues within 15 minutes
- **Clear Ownership**: Defined on-call rotation and responsibilities
- **Transparent Communication**: Public status updates during incidents
- **Continuous Improvement**: Learn from every incident

---

## Incident Severity Levels

### Severity 1 (Critical)

**Definition**: Complete service outage or data loss affecting majority of users

**Examples**:
- Installation script completely broken (no one can install)
- Binary crashes on startup for all users
- Safety validation failing to block dangerous commands (rm -rf passes through)
- Telemetry sending sensitive data (privacy breach)

**Response Time**:
- Acknowledge: **15 minutes**
- Initial update: **30 minutes**
- Resolution target: **4 hours**

**Communication**:
- GitHub banner: "We're investigating a critical issue"
- Discord announcement: "@everyone We're aware of X issue"
- Twitter update: Public acknowledgment

**On-Call**: Immediately page on-call engineer (PagerDuty, phone call)

---

### Severity 2 (High)

**Definition**: Major functionality broken affecting significant portion of users

**Examples**:
- LLM backend fails to load (fallback to static matcher works)
- Platform detection wrong (generates GNU commands on macOS)
- Performance degradation (commands take >10s to generate)
- Installation fails on specific platform (e.g., Linux ARM)

**Response Time**:
- Acknowledge: **1 hour**
- Initial update: **2 hours**
- Resolution target: **24 hours**

**Communication**:
- GitHub issue: Create tracking issue, pin to repository
- Discord: Post in #announcements
- Twitter: Optional, if widely reported

**On-Call**: Notify on-call engineer (Slack, email)

---

### Severity 3 (Medium)

**Definition**: Non-critical bug or degraded experience affecting subset of users

**Examples**:
- Specific command pattern not working (e.g., "find files" works, but "search for files" doesn't)
- Minor UI glitch (formatting issue in output)
- Documentation error (broken link, incorrect example)
- Performance issue on edge case (specific query type slow)

**Response Time**:
- Acknowledge: **4 hours**
- Initial update: **8 hours**
- Resolution target: **7 days**

**Communication**:
- GitHub issue: Standard issue, no pinning
- Discord: Optional, in #bugs channel

**On-Call**: Not required, handled during business hours

---

### Severity 4 (Low)

**Definition**: Minor inconvenience, cosmetic issue, or feature request

**Examples**:
- Feature request (new command pattern)
- Enhancement (improve existing feature)
- Code refactoring (no user impact)
- Documentation improvement

**Response Time**:
- Acknowledge: **1 week**
- Resolution: Prioritized in roadmap

**Communication**:
- GitHub issue: Standard process

**On-Call**: Not applicable

---

## Incident Response Process

### Step 1: Detection

**How incidents are detected**:

**1. User Reports**:
- GitHub issues
- Discord #bugs channel
- Twitter mentions
- Email (security@caro-cli.dev)

**2. Monitoring** (future, v1.2+):
- Error rate spike (telemetry)
- Crash reports
- Performance degradation

**3. Internal Testing**:
- Automated tests (CI/CD)
- Manual testing
- Dogfooding (team uses Caro daily)

---

### Step 2: Triage

**On-Call Engineer Actions** (within 15 min of detection):

1. **Assess Severity**: Determine S1, S2, S3, or S4
2. **Create Incident**: Create GitHub issue if not exists
3. **Acknowledge Publicly**: Post initial acknowledgment
4. **Gather Information**:
   - Platform (macOS, Linux)
   - Version (1.1.0-beta)
   - Steps to reproduce
   - Error messages
5. **Escalate if Needed**: Notify team if S1/S2

---

### Step 3: Investigation

**Debugging Process**:

1. **Reproduce Locally**: Confirm bug on own machine
2. **Check Recent Changes**: Review recent commits (git log)
3. **Review Logs**: Check error logs, telemetry (if available)
4. **Isolate Root Cause**: Binary search through code, add debug logging
5. **Identify Fix**: Determine what code needs changing

**Tools**:
- `cargo test`: Run tests to isolate failure
- `RUST_LOG=debug`: Enable debug logging
- `rust-gdb` / `rust-lldb`: Debugger for crashes
- Git bisect: Find commit that introduced bug

---

### Step 4: Fix

**Hotfix Process** (S1/S2):

```bash
# 1. Create hotfix branch from main
git checkout main
git pull origin main
git checkout -b hotfix/critical-issue-description

# 2. Implement fix
# Edit files...

# 3. Test thoroughly
cargo test
cargo clippy
cargo build --release

# Manual testing (reproduce original issue, verify fix)

# 4. Commit with clear message
git commit -m "fix(critical): description of fix

- Root cause explanation
- Fix implementation
- Test results

Fixes #123 (S1 incident)"

# 5. Push and create PR
git push origin hotfix/critical-issue-description
gh pr create --title "Hotfix: Critical issue" --body "..."

# 6. Fast-track review (skip normal review for S1)
# Merge immediately if verified

# 7. Tag and release
git tag v1.1.1
git push origin v1.1.1

# CI/CD builds and publishes binaries
```

**Hotfix Timeline** (S1):
- Fix implementation: 1-2 hours
- Testing: 30 minutes
- Release: 30 minutes
- **Total: 2-3 hours from incident detection to fix deployed**

---

**Standard Fix** (S3/S4):
- Follow normal PR process
- Schedule in next release (weekly or monthly)

---

### Step 5: Communication

**During Incident** (S1/S2):

**Initial Acknowledgment** (within 15-30 min):
```markdown
## GitHub Issue Title: [S1] Installation script broken on macOS

We're investigating reports that the installation script fails on macOS.

**Status**: Investigating
**Severity**: S1 (Critical)
**ETA**: 2-4 hours

We'll provide updates every 30 minutes.

Workaround: Install manually from GitHub releases for now.
```

**Progress Updates** (every 30 min for S1, hourly for S2):
```markdown
**Update 1** (30 min):
- Root cause identified: curl not found on fresh macOS installs
- Fix in progress: Add check for curl, provide clear error message
- ETA: 1 hour
```

**Resolution Update**:
```markdown
**Update: RESOLVED** (2h 15min):
- Fix deployed: v1.1.1 released
- Root cause: Installation script assumed curl was present
- Fix: Added check for curl, fallback to wget, clear error if neither
- Users: Please re-run install script or download binary manually

Thank you for your patience!
```

---

### Step 6: Post-Incident Review

**Within 48 Hours** (S1/S2):

Create post-incident review document:

```markdown
# Post-Incident Review: Installation Script Failure (S1)

**Date**: 2026-01-16
**Duration**: 2 hours 15 minutes (detection to resolution)
**Severity**: S1 (Critical)

## Summary
Installation script failed on fresh macOS installs due to missing curl.

## Timeline
- 10:00 AM: First user report on Discord
- 10:15 AM: On-call engineer acknowledged, created GitHub issue
- 10:30 AM: Root cause identified (curl check missing)
- 11:00 AM: Fix implemented and tested
- 11:30 AM: Hotfix PR merged, v1.1.1 tagged
- 12:00 PM: Binaries built and published
- 12:15 PM: Fix verified, incident closed

## Root Cause
Installation script assumed curl was always present on macOS. Fresh installs (without Xcode Command Line Tools) don't have curl.

## Fix
Added check for curl, fallback to wget, clear error message if neither available.

## What Went Well
- Fast detection (15 minutes)
- Clear ownership (on-call engineer responded immediately)
- Good communication (updates every 30 min)
- Fast fix (2h 15min total)

## What Could Be Improved
- Better testing: Should have tested on fresh macOS VM
- Proactive detection: Could add telemetry for installation success rate

## Action Items
- [ ] Add installation tests on fresh VMs (all platforms)
- [ ] Add installation success telemetry (opt-in)
- [ ] Document common installation issues in FAQ

## Follow-Up
- Review in weekly team meeting (2026-01-20)
- Update runbook with learnings
```

---

## On-Call Rotation

### Schedule

**Current Team Size**: 2-3 engineers (small team, beta phase)

**Rotation**:
- **Week 1**: Alice (primary), Bob (backup)
- **Week 2**: Bob (primary), Charlie (backup)
- **Week 3**: Charlie (primary), Alice (backup)

**Tool**: PagerDuty (free tier) or Google Calendar

---

### On-Call Responsibilities

**Primary On-Call**:
- Monitor #bugs channel in Discord
- Check GitHub issues (email notifications)
- Respond to S1/S2 incidents within 15 min / 1 hour
- Perform hotfixes if needed
- Provide status updates

**Backup On-Call**:
- Available if primary is unreachable
- Escalation path for complex incidents

**Off-Duty**:
- No expectation to respond
- Enjoy your weekend/evening!

---

### On-Call Compensation

**Beta Phase** (volunteer OSS project):
- Recognition in release notes
- "On-Call Hero" badge on Discord
- Pizza/coffee on the project (once funded)

**Future** (if project becomes paid):
- $100/day on-call stipend
- Time off in lieu for incidents handled

---

## Escalation Paths

### When to Escalate

**Escalate to Backup On-Call** if:
- Primary on-call unavailable (no response in 15 min)
- Incident complexity exceeds primary's expertise

**Escalate to Engineering Lead** if:
- S1 incident not resolved within 4 hours
- Security incident (data breach, vulnerability)
- Need to make architectural decision

**Escalate to Project Maintainer** if:
- Legal issue (DMCA, licensing)
- PR crisis (negative press coverage)
- Major community issue (CoC violation)

---

### Contact Information

**Primary Contacts**:
- Alice (Primary On-Call): +1-555-0101, alice@example.com
- Bob (Backup On-Call): +1-555-0102, bob@example.com
- Engineering Lead: lead@example.com
- Project Maintainer: maintainer@example.com

**Emergency**: If on-call unreachable, post in Discord #team-private

---

## Common Incidents and Runbooks

### Runbook 1: Installation Failure

**Symptoms**: Users report "curl: command not found" or similar

**Diagnosis**:
```bash
# Test installation on fresh VM
docker run -it ubuntu:22.04 bash
curl -sSL https://caro-cli.dev/install.sh | sh
```

**Common Causes**:
- Missing curl/wget
- Network issues (firewall, proxy)
- GitHub rate limiting
- Binary not found (wrong architecture)

**Fix**:
- Add check for curl/wget, provide clear error
- Add retry logic for network issues
- Document manual installation steps

---

### Runbook 2: Binary Crashes on Startup

**Symptoms**: Users report `Segmentation fault` or `Illegal instruction`

**Diagnosis**:
```bash
# Run with backtrace
RUST_BACKTRACE=1 caro --version

# Check binary architecture
file /usr/local/bin/caro

# Check for missing libraries (Linux)
ldd /usr/local/bin/caro
```

**Common Causes**:
- Wrong architecture (x86_64 on ARM)
- Missing system libraries (glibc mismatch)
- Corrupted binary (download issue)

**Fix**:
- Rebuild binary for correct architecture
- Use static linking (musl) for Linux
- Add checksum verification to install script

---

### Runbook 3: Slow Command Generation

**Symptoms**: Users report commands take >10 seconds

**Diagnosis**:
```bash
# Test with debug logging
RUST_LOG=debug caro "test query"

# Check which backend is used (static vs LLM)
# Check model loading time (embedded backend)

# Profile performance
cargo build --release
time ./target/release/caro "test query"
```

**Common Causes**:
- LLM backend slow to load (cold start)
- Large model file (Qwen 1.5B)
- Disk I/O slow (HDD vs SSD)
- CPU throttling (thermal)

**Fix**:
- Optimize model loading (lazy loading, caching)
- Use smaller model by default (SmolLM 135M)
- Document performance expectations
- Add performance telemetry

---

### Runbook 4: Safety Validation Failure

**Symptoms**: Dangerous command not blocked (e.g., `rm -rf /` allowed)

**Severity**: **S1 (Critical)** - Immediate escalation

**Diagnosis**:
```bash
# Test safety validation
cargo test --test safety_patterns

# Check specific pattern
cargo test test_rm_rf_root

# Verify validation is enabled
caro "delete everything"  # Should be blocked
```

**Common Causes**:
- Safety pattern regex bug
- Validation disabled (config error)
- New attack vector (variant of known pattern)

**Fix**:
- Add missing safety pattern
- Update regex to catch variant
- Add test case for new pattern
- **Hotfix immediately** (S1)

---

## Production Monitoring (Future, v1.2+)

### Metrics to Monitor

**1. Error Rate**:
- Command generation failures
- Backend errors (LLM inference)
- Validation errors

**Target**: <5% error rate

---

**2. Latency**:
- p50, p95, p99 command generation time
- Static matcher: <50ms
- Embedded backend: <2000ms

**Alert**: p95 >5000ms (5 seconds)

---

**3. Crash Rate**:
- Binary crashes (segfault, panic)

**Target**: <0.1% of sessions

---

**4. Installation Success Rate**:
- Successful installs vs. failed attempts

**Target**: >95%

---

### Alerting

**PagerDuty** (or similar):
- S1: Page on-call immediately (phone call, SMS)
- S2: Slack notification, email
- S3: Email only

**Alert Conditions**:
- Error rate >10% for 5 minutes â†’ S2 alert
- Crash rate >1% for 5 minutes â†’ S1 alert
- p95 latency >10s for 10 minutes â†’ S2 alert

---

## User Support

### Support Channels

**1. GitHub Issues** (Primary):
- Bug reports
- Feature requests
- General questions

**Response Time**: <24 hours for S1/S2, <1 week for S3/S4

---

**2. Discord #help** (Real-Time):
- Quick questions
- Troubleshooting
- Community support (peer-to-peer)

**Response Time**: <1 hour during business hours

---

**3. Email** (Security, Legal):
- security@caro-cli.dev: Vulnerability reports
- legal@caro-cli.dev: Licensing, DMCA

**Response Time**: <4 hours for security, <1 week for legal

---

### Support Best Practices

**1. Be Empathetic**:
```
âŒ BAD: "This is not a bug, it's expected behavior."
âœ… GOOD: "Thanks for the report! This is expected behavior because X, but I can see how it's confusing. Let me improve the docs."
```

**2. Ask for Details**:
```
Template response for bug reports:

Thanks for reporting this! To help me reproduce, could you provide:
- OS and version (macOS 13, Ubuntu 22.04, etc.)
- Caro version (`caro --version`)
- Exact query you ran
- Full error message (if any)
- Expected vs. actual behavior
```

**3. Provide Workarounds**:
```
This is a known issue (#123). We're working on a fix for v1.1.2.

In the meantime, here's a workaround:
[Workaround steps]
```

**4. Follow Up**:
```
We've just released v1.1.2 with a fix for this issue! Could you try upgrading and let us know if it works?
```

---

## Security Incident Response

### Security Issue Severity

**Critical**: Remote code execution, data breach, privilege escalation
**High**: Local code execution, DoS, safety validation bypass
**Medium**: Information disclosure, minor vulnerabilities
**Low**: Theoretical vulnerabilities, low impact

---

### Security Incident Process

**1. Report Received** (security@caro-cli.dev):
- Acknowledge within 4 hours
- Assess severity
- **Do not publicly disclose** until fix ready

**2. Verify and Reproduce**:
- Confirm vulnerability exists
- Determine affected versions
- Estimate impact (# of users affected)

**3. Develop Fix**:
- Create private fork/branch (no public visibility)
- Implement and test fix
- Prepare security advisory

**4. Coordinate Disclosure**:
- Notify major users (if any)
- Prepare public advisory (GitHub Security Advisory)
- Plan release timeline

**5. Release Fix**:
- Tag security release (e.g., v1.1.2-security)
- Publish binaries
- Publish security advisory
- Notify users (GitHub, Discord, Twitter)

**6. Credit Reporter**:
- Thank reporter publicly (with permission)
- Add to SECURITY.md credits

---

### Example Security Advisory

```markdown
# Security Advisory: Command Injection in Static Matcher

**Severity**: High (CVSS 7.5)
**Affected Versions**: 1.1.0-beta, 1.1.1
**Fixed Version**: 1.1.2

## Summary
A command injection vulnerability in the static matcher allows attackers to execute arbitrary commands by crafting malicious input.

## Impact
Users who run Caro with untrusted input (e.g., piped from external source) could execute arbitrary commands.

## Affected Components
- `src/backends/static_matcher.rs`: Pattern matching logic

## Remediation
Upgrade to v1.1.2 immediately:
\`\`\`bash
curl -sSL https://caro-cli.dev/install.sh | sh
\`\`\`

## Workaround
No workaround available. Upgrade required.

## Credits
Thank you to @security_researcher for responsibly disclosing this issue.

## Timeline
- 2026-01-20: Issue reported
- 2026-01-21: Fix developed and tested
- 2026-01-22: Security release (v1.1.2) published
- 2026-01-22: Public disclosure
```

---

## Communication Templates

### Template 1: S1 Incident Acknowledgment

```markdown
ðŸš¨ **INCIDENT ALERT** ðŸš¨

We're investigating reports of [ISSUE DESCRIPTION].

**Status**: Investigating
**Severity**: S1 (Critical)
**Impact**: [DESCRIPTION OF IMPACT]
**ETA**: 2-4 hours

**Workaround**: [IF AVAILABLE]

We'll provide updates every 30 minutes.

Thank you for your patience.
```

---

### Template 2: Incident Resolution

```markdown
âœ… **RESOLVED**

The issue with [ISSUE DESCRIPTION] has been resolved.

**Fix**: [DESCRIPTION OF FIX]
**Version**: v1.1.X (released 10 minutes ago)

**Action Required**: Please upgrade:
\`\`\`bash
curl -sSL https://caro-cli.dev/install.sh | sh
\`\`\`

**Post-Mortem**: We'll publish a full post-mortem within 48 hours.

Thank you for your patience and for reporting this issue!
```

---

### Template 3: Planned Maintenance

```markdown
ðŸ› ï¸ **MAINTENANCE WINDOW** ðŸ› ï¸

We're performing planned maintenance:

**Date**: 2026-01-25, 2:00 AM - 4:00 AM UTC
**Duration**: ~2 hours
**Impact**: GitHub releases may be unavailable during this time

No action required. Caro will continue to work normally.

Questions? Ask in #help on Discord.
```

---

## Continuous Improvement

### Incident Retrospective

**After every S1/S2 incident**:
1. Create post-incident review (within 48 hours)
2. Identify action items
3. Assign owners and deadlines
4. Track to completion
5. Share learnings with team

---

### Metrics to Track

**Incident Frequency**:
- S1 per month (target: 0)
- S2 per month (target: <2)

**Response Time**:
- Time to acknowledgment (target: <15 min for S1)
- Time to resolution (target: <4 hours for S1)

**User Impact**:
- Users affected (from telemetry)
- Downtime duration

---

### Runbook Maintenance

**Quarterly Review**:
- Update runbooks with new learnings
- Remove outdated sections
- Add new common incidents

---

## Document Control

**Change History**:
- v1.0 (2026-01-08): Initial incident response procedures

**Review Cycle**: Quarterly (or after major incident)

**Owner**: Engineering Lead

**Stakeholders**: On-Call Engineers, Project Maintainer

---

## References

- [Incident Response Guide](https://response.pagerduty.com/)
- [Google SRE Book: Incident Response](https://sre.google/sre-book/incident-response/)
- [PagerDuty Incident Severity Levels](https://www.pagerduty.com/resources/learn/incident-severity-levels/)

---

**Document Status**: âœ… Ready for Implementation
**Next Review**: April 2026 (Post-Launch Review)

---

**Stay calm, communicate clearly, and fix fast. We've got this! ðŸ’ª**