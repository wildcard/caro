# Caro Version Management Guide

**Purpose**: Comprehensive guide for version numbering, branching, and release lifecycle
**Audience**: Engineering Team, Release Manager, Contributors
**Scope**: All caro releases (beta, stable, patches, major versions)

---

## Version Numbering Scheme

### Semantic Versioning (SemVer)

Caro follows **Semantic Versioning 2.0.0**: `MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]`

**Format**: `X.Y.Z[-prerelease][+metadata]`

**Components**:
- **MAJOR** (X): Incompatible API changes
- **MINOR** (Y): Backwards-compatible new features
- **PATCH** (Z): Backwards-compatible bug fixes
- **PRERELEASE**: Optional pre-release identifier (alpha, beta, rc)
- **BUILD**: Optional build metadata (commit hash, build number)

---

### Version Examples

| Version | Type | When to Use | Example |
|---------|------|-------------|---------|
| `1.0.0` | Stable Release | First public stable release | Initial GA |
| `1.1.0` | Minor Release | New features added | Telemetry feature added |
| `1.1.1` | Patch Release | Bug fixes only | Hotfix for telemetry bug |
| `2.0.0` | Major Release | Breaking API changes | CLI interface redesign |
| `1.1.0-alpha` | Alpha | Early testing, unstable | Internal testing only |
| `1.1.0-beta` | Beta | Feature complete, public testing | Current v1.1.0 release |
| `1.1.0-beta.1` | Beta Hotfix | Critical fix for beta | Emergency patch |
| `1.1.0-rc.1` | Release Candidate | Final testing before GA | Production-ready candidate |
| `1.1.0+20260108` | Build Metadata | CI/CD builds | Nightly builds |

---

## Version Increment Rules

### When to Increment MAJOR (X.0.0)

**Increment when**:
- Breaking changes to CLI interface
- Removing commands or flags
- Changing command behavior incompatibly
- Removing public APIs
- Major architectural changes affecting users

**Examples**:
```bash
# v1.x.x → v2.0.0
# Breaking: Remove --no-safety flag
caro "command"  # v1.x: Had --no-safety flag
caro "command"  # v2.0: Flag removed, always safe

# Breaking: Change JSON output format
caro --format json  # v1.x: {"command": "..."}
caro --format json  # v2.0: {"cmd": "...", "metadata": {...}}
```

**Communication**:
- Announce breaking changes 30+ days before release
- Provide migration guide
- Deprecate features in MINOR release first (when possible)

---

### When to Increment MINOR (X.Y.0)

**Increment when**:
- Adding new commands
- Adding new flags (backwards-compatible)
- Adding new backends
- Adding new features
- Enhancing existing features (non-breaking)

**Examples**:
```bash
# v1.0.0 → v1.1.0
# New: Telemetry feature
caro telemetry show  # New command

# v1.1.0 → v1.2.0
# New: AI backend selection
caro --backend openai "command"  # New flag
```

**Backwards Compatibility**:
- Old commands still work exactly as before
- New features are additive
- Existing behavior unchanged

---

### When to Increment PATCH (X.Y.Z)

**Increment when**:
- Bug fixes (no new features)
- Performance improvements
- Documentation updates
- Internal refactoring
- Security patches

**Examples**:
```bash
# v1.1.0 → v1.1.1
# Fix: Command generation error for specific query
# No new features, existing behavior corrected

# v1.1.1 → v1.1.2
# Fix: Memory leak in telemetry upload
# Performance improvement, no API changes
```

**Guidelines**:
- No new features
- No breaking changes
- Safe to auto-update

---

## Pre-Release Versions

### Alpha (`X.Y.Z-alpha[.N]`)

**Purpose**: Early internal testing, highly unstable

**Characteristics**:
- Features incomplete
- APIs may change drastically
- Not feature-complete
- Internal testing only
- No public announcement

**Versioning**:
```bash
1.2.0-alpha      # First alpha
1.2.0-alpha.1    # First alpha with fixes
1.2.0-alpha.2    # Second alpha iteration
```

**When to Use**:
- Very early feature development
- Experimental features
- Internal team testing
- Proof of concept

**Publishing**: Do NOT publish to crates.io

---

### Beta (`X.Y.Z-beta[.N]`)

**Purpose**: Public testing, feature-complete but may have bugs

**Characteristics**:
- Feature-complete
- APIs mostly stable (minor changes possible)
- Public testing
- Known bugs acceptable
- Documentation complete

**Versioning**:
```bash
1.1.0-beta       # First beta (current v1.1.0)
1.1.0-beta.1     # Hotfix for beta
1.1.0-beta.2     # Second hotfix
```

**When to Use**:
- Feature development complete
- Ready for public feedback
- 2-4 weeks of testing needed
- APIs finalized

**Publishing**: Publish to crates.io with `--pre` flag

**Example**: Current v1.1.0-beta release

---

### Release Candidate (`X.Y.Z-rc[.N]`)

**Purpose**: Final validation before stable release

**Characteristics**:
- Production-ready
- No known critical bugs
- APIs frozen (no changes)
- Documentation finalized
- 1-2 weeks of validation
- Very low risk

**Versioning**:
```bash
1.1.0-rc.1       # First release candidate
1.1.0-rc.2       # Second RC (if issues found)
1.1.0            # Stable (if RC.2 passes)
```

**When to Use**:
- After successful beta
- Before GA release
- Final validation period
- Enterprise adoption testing

**Publishing**: Publish to crates.io with `--pre` flag

**Note**: Caro v1.1.0 is going directly from beta → GA (no RC) due to thorough beta testing.

---

## Version Lifecycle

### Typical Release Lifecycle

```
Development → Alpha → Beta → RC → Stable → Maintenance → EOL
     ↓          ↓       ↓      ↓      ↓          ↓         ↓
  feature   internal public final   GA      patches    archived
   work      test    test   check release   only
```

### Lifecycle Stages

#### 1. Development (Not Versioned)

**Duration**: Weeks to months
**Branch**: `feature/*`, `main`
**Testing**: Local development only
**Publishing**: No

**Activities**:
- Feature development
- Code reviews
- Unit testing
- Integration testing

---

#### 2. Alpha (X.Y.Z-alpha)

**Duration**: 1-2 weeks (if used)
**Branch**: `release/vX.Y.Z-alpha`
**Testing**: Internal team
**Publishing**: No (internal distribution)

**Activities**:
- Internal testing
- API refinement
- Major bugs expected
- Rapid iteration

**Exit Criteria**:
- Core features working
- APIs mostly defined
- Ready for external feedback

---

#### 3. Beta (X.Y.Z-beta)

**Duration**: 2-4 weeks
**Branch**: `release/vX.Y.Z-beta`
**Testing**: Public beta testers (3-5 testers)
**Publishing**: Yes (crates.io with pre-release flag)

**Activities**:
- Public testing
- Bug fixes
- Performance optimization
- Documentation refinement
- Telemetry collection

**Exit Criteria**:
- Pass rate ≥ 75%
- Zero P0 bugs
- User satisfaction ≥ 4.0/5.0
- Installation success ≥ 80%
- Privacy: ZERO PII collected

**Current**: v1.1.0-beta (in this stage)

---

#### 4. Release Candidate (X.Y.Z-rc) [OPTIONAL]

**Duration**: 1-2 weeks
**Branch**: `release/vX.Y.Z-rc`
**Testing**: Production validation
**Publishing**: Yes (crates.io with pre-release flag)

**Activities**:
- Final validation
- Performance testing
- Security audit
- Documentation review
- No new features

**Exit Criteria**:
- Zero P0/P1 bugs
- Performance benchmarks met
- Security audit passed
- Documentation complete

**Note**: v1.1.0 skipping RC due to thorough beta

---

#### 5. Stable (X.Y.Z)

**Duration**: Months to years
**Branch**: `main` (merged from release branch)
**Testing**: Continuous monitoring
**Publishing**: Yes (crates.io stable)

**Activities**:
- Production use
- Monitoring
- Patch releases (X.Y.Z+1)
- Security updates
- Bug fixes

**Support Level**: Full support

**Example**: v1.1.0 (after GA promotion on ~Feb 15, 2026)

---

#### 6. Maintenance (X.Y.Z - older versions)

**Duration**: 6-12 months after next MINOR
**Branch**: `maint/vX.Y`
**Testing**: Regression testing
**Publishing**: Patches only

**Activities**:
- Critical bug fixes only
- Security patches
- No new features
- Documentation updates

**Support Level**: Security patches only

**Example**: v1.0.x after v1.1.0 released

---

#### 7. End of Life (EOL)

**Duration**: After maintenance period
**Branch**: Archived
**Testing**: None
**Publishing**: No new releases

**Activities**:
- Archive repository branch
- Update documentation (EOL notice)
- Redirect users to newer version

**Support Level**: None

**Example**: v0.x after v1.0.0 stable for 12+ months

---

## Branching Strategy

### Branch Types

#### `main`

**Purpose**: Stable production code
**Protection**: Requires PR approval
**Contains**: Latest stable release
**Tags**: `vX.Y.Z` (stable versions only)

**Rules**:
- Only merge from release branches
- All tests must pass
- Requires code review
- CI/CD must succeed

---

#### `release/vX.Y.Z[-prerelease]`

**Purpose**: Prepare specific release
**Protection**: Requires PR approval
**Contains**: Version-specific changes
**Tags**: `vX.Y.Z[-prerelease]`, `vX.Y.Z[-prerelease].N` (hotfixes)

**Examples**:
```bash
release/v1.1.0-beta        # Beta release branch
release/v1.2.0             # Stable release branch
```

**Workflow**:
1. Branch from `main`
2. Make release-specific changes
3. Tag pre-releases
4. Merge to `main` when stable

---

#### `hotfix/vX.Y.Z[.N]`

**Purpose**: Emergency patches
**Protection**: Fast-track review
**Contains**: Critical bug fixes
**Tags**: `vX.Y.Z.N` or `vX.Y.Z-beta.N`

**Examples**:
```bash
hotfix/v1.1.0-beta.1       # Beta hotfix
hotfix/v1.1.1              # Stable hotfix
```

**Workflow**:
1. Branch from release tag
2. Fix critical bug
3. Test thoroughly
4. Tag and publish
5. Merge back to `main` and active release branches

---

#### `feature/*`

**Purpose**: New feature development
**Protection**: Optional (team preference)
**Contains**: Feature work in progress
**Tags**: None

**Examples**:
```bash
feature/telemetry
feature/openai-backend
feature/command-caching
```

**Workflow**:
1. Branch from `main`
2. Develop feature
3. PR to `main` when ready
4. Delete after merge

---

#### `maint/vX.Y`

**Purpose**: Maintain older MINOR versions
**Protection**: Requires PR approval
**Contains**: Backported fixes
**Tags**: `vX.Y.Z+1`, `vX.Y.Z+2` (patches)

**Examples**:
```bash
maint/v1.0    # Maintain v1.0.x after v1.1.0 released
maint/v1.1    # Maintain v1.1.x after v1.2.0 released
```

**Workflow**:
1. Create when new MINOR released
2. Backport critical fixes
3. Tag patch releases
4. Archive when EOL

---

## Version Files

### Files Containing Version Numbers

**Must be updated together for each release**:

1. **`Cargo.toml`**
   ```toml
   [package]
   name = "caro"
   version = "1.1.0-beta"  # ← Update here
   ```

2. **`Cargo.lock`**
   ```toml
   # Auto-updated by: cargo build
   ```

3. **`src/version.rs`** (if exists)
   ```rust
   pub const VERSION: &str = "1.1.0-beta";  // ← Update here
   ```

4. **`CHANGELOG.md`**
   ```markdown
   ## [1.1.0-beta] - 2026-01-24  # ← Add section
   ```

5. **`README.md`** (badge)
   ```markdown
   ![Version](https://img.shields.io/badge/version-1.1.0--beta-blue)
   ```

### Automated Version Bumping

**Script**: Create `.claude/scripts/bump-version.sh`

```bash
#!/bin/bash
# Usage: ./bump-version.sh 1.1.0-beta.1

NEW_VERSION=$1

if [ -z "$NEW_VERSION" ]; then
  echo "Usage: $0 <new_version>"
  exit 1
fi

# Update Cargo.toml
sed -i '' "s/^version = \".*\"/version = \"$NEW_VERSION\"/" Cargo.toml

# Update src/version.rs (if exists)
if [ -f src/version.rs ]; then
  sed -i '' "s/const VERSION: &str = \".*\"/const VERSION: &str = \"$NEW_VERSION\"/" src/version.rs
fi

# Regenerate Cargo.lock
cargo build --release

# Commit
git add Cargo.toml Cargo.lock src/version.rs
git commit -m "chore: Bump version to $NEW_VERSION"

echo "✅ Version bumped to $NEW_VERSION"
```

---

## Git Tagging

### Tag Format

**Stable**: `vX.Y.Z`
**Pre-release**: `vX.Y.Z-prerelease[.N]`
**Hotfix**: `vX.Y.Z.N` or `vX.Y.Z-prerelease.N`

### Tagging Commands

**Create annotated tag**:
```bash
git tag -a v1.1.0-beta -m "Release v1.1.0-beta"
```

**Create signed tag** (recommended):
```bash
git tag -s v1.1.0 -m "Release v1.1.0"
```

**Push tag**:
```bash
git push origin v1.1.0-beta
```

**List tags**:
```bash
git tag -l "v1.*"
```

**Delete tag** (local):
```bash
git tag -d v1.1.0-beta
```

**Delete tag** (remote):
```bash
git push --delete origin v1.1.0-beta
```

---

## Publishing to crates.io

### Pre-Release Publishing

**Command**:
```bash
cargo publish --dry-run  # Test first
cargo publish            # Actual publish
```

**Result**:
- Published as pre-release automatically (due to `-beta` suffix)
- Users must specify version explicitly: `cargo install caro --version 1.1.0-beta`
- Does NOT auto-update for users

### Stable Publishing

**Command**:
```bash
cargo publish --dry-run
cargo publish
```

**Result**:
- Published as stable release
- Becomes default version: `cargo install caro`
- Auto-updates for users

### Publishing Checklist

Before `cargo publish`:

- [ ] All tests pass: `cargo test`
- [ ] Clean build: `cargo clean && cargo build --release`
- [ ] Version bumped in all files
- [ ] CHANGELOG.md updated
- [ ] Git tag created
- [ ] Documentation up to date
- [ ] README accurate

**CRITICAL**: Publishing to crates.io is **IRREVERSIBLE**. Cannot unpublish.

---

## Version Compatibility

### Breaking Changes

**Definition**: Changes that require users to modify their usage

**Examples**:
- Removing commands
- Changing command behavior
- Removing flags
- Changing output format
- Changing configuration file format

**Guidelines**:
- Requires MAJOR version bump
- Announce 30+ days in advance
- Provide migration guide
- Deprecate in MINOR first (when possible)

### Backwards Compatibility

**Definition**: New version works with old usage

**Guidelines**:
- Add new commands (safe)
- Add new flags (safe)
- Add new output fields (safe)
- Enhance existing behavior (safe if non-breaking)

**Testing**:
```bash
# Test that old commands still work
caro "list files"           # v1.0 command
caro --format json "query"  # v1.0 flag

# Should work identically in v1.1
```

---

## Version Support Policy

### Support Levels

| Version Type | Support Duration | Updates |
|--------------|------------------|---------|
| **Current Stable** | Until next MAJOR | Full support (features + patches) |
| **Previous MINOR** | 6 months | Security patches only |
| **Older MINOR** | None (EOL) | No updates |
| **Beta/RC** | 2-4 weeks | Active development |
| **Alpha** | 1-2 weeks | Internal only |

### Support Examples

**Scenario**: v1.2.0 just released

- **v1.2.x**: Full support (current)
- **v1.1.x**: Security patches for 6 months (previous MINOR)
- **v1.0.x**: EOL, no updates
- **v0.x**: EOL, archived

### Security Patches

**Timeline**:
- Discover vulnerability: Day 0
- Fix developed: Day 0-2
- Patch released: Day 2-7
- Public disclosure: Day 7+ (after patch available)

**Supported Versions**:
- Current stable: Always
- Previous MINOR: If within support window
- Older: No patches (upgrade recommended)

---

## Deprecation Policy

### Deprecation Process

**Timeline**: Minimum 2 MINOR releases

**Example**:
```bash
# v1.0: Feature introduced
caro --old-flag "query"

# v1.1: Deprecate old, introduce new
caro --old-flag "query"  # Warning: Deprecated, use --new-flag
caro --new-flag "query"  # New way

# v1.2: Keep both
# Still both work, warning persists

# v2.0: Remove old
caro --old-flag "query"  # Error: Unknown flag
caro --new-flag "query"  # Only way
```

### Deprecation Notices

**In Code**:
```rust
#[deprecated(since = "1.1.0", note = "Use `new_feature` instead")]
pub fn old_feature() { ... }
```

**In CLI**:
```
Warning: --old-flag is deprecated since v1.1.0.
Please use --new-flag instead.
This flag will be removed in v2.0.0.
```

**In Documentation**:
```markdown
## `--old-flag` (Deprecated)

**Status**: Deprecated since v1.1.0
**Removal**: v2.0.0
**Alternative**: Use `--new-flag` instead
```

---

## Version Decision Matrix

### Should I Publish a New Version?

| Change | Version Bump | Publish? | Testing |
|--------|--------------|----------|---------|
| New feature | MINOR | Yes | Full |
| Bug fix | PATCH | Yes | Regression |
| Performance | PATCH | Yes | Benchmarks |
| Documentation | PATCH | Optional | Review |
| Refactoring | None/PATCH | No/Maybe | Full |
| Breaking change | MAJOR | Yes | Extensive |
| Security fix | PATCH | Immediately | Security audit |
| Dependency update | PATCH | If significant | Regression |

---

## Common Scenarios

### Scenario 1: Beta Hotfix

**Situation**: Critical bug in v1.1.0-beta

**Steps**:
1. Create hotfix branch: `hotfix/v1.1.0-beta.1`
2. Fix bug
3. Bump version: `1.1.0-beta` → `1.1.0-beta.1`
4. Test thoroughly
5. Tag: `v1.1.0-beta.1`
6. Publish: `cargo publish`
7. Notify beta testers

**Result**: v1.1.0-beta.1 published

---

### Scenario 2: Beta to GA

**Situation**: Beta testing complete, ready for GA

**Steps**:
1. Final validation
2. Bump version: `1.1.0-beta` → `1.1.0`
3. Update CHANGELOG
4. Merge release branch to `main`
5. Tag: `v1.1.0`
6. Publish: `cargo publish`
7. Announce GA release

**Result**: v1.1.0 stable published

---

### Scenario 3: Stable Hotfix

**Situation**: Critical bug in v1.1.0 stable

**Steps**:
1. Create hotfix branch: `hotfix/v1.1.1`
2. Fix bug
3. Bump version: `1.1.0` → `1.1.1`
4. Test thoroughly
5. Tag: `v1.1.1`
6. Publish: `cargo publish`
7. Announce hotfix

**Result**: v1.1.1 stable published

---

### Scenario 4: New Feature Release

**Situation**: New feature ready after v1.1.0

**Steps**:
1. Create release branch: `release/v1.2.0`
2. Bump version: `1.1.0` → `1.2.0`
3. Update CHANGELOG
4. Full testing
5. Merge to `main`
6. Tag: `v1.2.0`
7. Publish: `cargo publish`
8. Create maintenance branch: `maint/v1.1`

**Result**: v1.2.0 stable published, v1.1.x enters maintenance

---

### Scenario 5: Major Version

**Situation**: Breaking changes accumulated

**Steps**:
1. Announce breaking changes (30+ days ahead)
2. Create migration guide
3. Create release branch: `release/v2.0.0`
4. Implement breaking changes
5. Beta testing: `v2.0.0-beta`
6. RC testing: `v2.0.0-rc.1`
7. GA release: `v2.0.0`
8. Create maintenance branch: `maint/v1.x`

**Result**: v2.0.0 stable published, v1.x enters long-term maintenance

---

## Tools & Automation

### Recommended Tools

1. **cargo-release**: Automate release process
   ```bash
   cargo install cargo-release
   cargo release patch  # For PATCH
   cargo release minor  # For MINOR
   cargo release major  # For MAJOR
   ```

2. **git-cliff**: Generate CHANGELOG
   ```bash
   git cliff -o CHANGELOG.md
   ```

3. **cargo-outdated**: Check dependency updates
   ```bash
   cargo outdated
   ```

4. **cargo-audit**: Security vulnerability scanning
   ```bash
   cargo audit
   ```

### CI/CD Integration

**GitHub Actions**: `.github/workflows/release.yml`

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions-rs/toolchain@v1
      - name: Publish to crates.io
        run: cargo publish --token ${{ secrets.CARGO_TOKEN }}
```

---

## Version History Template

**Track version history in CHANGELOG.md**:

```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
### Changed
### Deprecated
### Removed
### Fixed
### Security

## [1.1.0] - 2026-02-15

### Added
- Privacy-first telemetry with ZERO PII guarantee
- Fire-and-forget telemetry with 0.002ms overhead
- Improved command generation with prompt engineering

### Fixed
- Static matcher pattern ordering issues
- Platform detection edge cases

## [1.0.0] - 2025-12-01

### Added
- Initial stable release
- Natural language to shell command generation
- Static pattern matching
- Embedded LLM backend

[Unreleased]: https://github.com/owner/caro/compare/v1.1.0...HEAD
[1.1.0]: https://github.com/owner/caro/compare/v1.0.0...v1.1.0
[1.0.0]: https://github.com/owner/caro/releases/tag/v1.0.0
```

---

## Best Practices

### Version Numbering

✅ **DO**:
- Follow SemVer strictly
- Increment appropriately for changes
- Use pre-release tags for testing
- Document breaking changes clearly

❌ **DON'T**:
- Skip versions arbitrarily
- Use marketing version numbers
- Reuse version numbers
- Publish without testing

### Branching

✅ **DO**:
- Create release branches for major releases
- Use hotfix branches for emergencies
- Merge back to main after release
- Keep main stable

❌ **DON'T**:
- Develop directly on main
- Skip code review for hotfixes (unless emergency)
- Leave stale branches

### Publishing

✅ **DO**:
- Test thoroughly before publishing
- Update CHANGELOG before release
- Tag before publishing
- Verify publication succeeds

❌ **DON'T**:
- Publish untested code
- Publish without documentation
- Forget to tag
- Skip dry-run

---

## Quick Reference

### Common Commands

```bash
# Bump version in files
sed -i '' 's/version = "1.1.0"/version = "1.1.1"/' Cargo.toml
cargo build --release  # Regenerate lock

# Create tag
git tag -a v1.1.1 -m "Release v1.1.1"
git push origin v1.1.1

# Publish
cargo publish --dry-run
cargo publish

# Check current version
cargo pkgid | cut -d# -f2
```

### Version Bump Examples

```bash
1.0.0 → 1.0.1   # Patch (bug fixes)
1.0.0 → 1.1.0   # Minor (new features)
1.0.0 → 2.0.0   # Major (breaking changes)

1.1.0-beta → 1.1.0-beta.1   # Beta hotfix
1.1.0-beta → 1.1.0          # Beta to GA
```

---

**Document Status**: Complete and ready for use
**Next Review**: After first hotfix (update with lessons learned)
**Maintenance**: Update after each release cycle
