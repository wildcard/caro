name: Translate Website Content

on:
  push:
    branches: [main]
    paths:
      - 'website/src/i18n/locales/en/**/*.json'
  workflow_dispatch:
    inputs:
      force_retranslate:
        description: 'Force retranslation of all files'
        type: boolean
        default: false
      backend:
        description: 'Translation backend to use'
        type: choice
        options:
          - openai
          - libretranslate
          - claude
        default: openai

permissions:
  contents: write
  pull-requests: write

jobs:
  translate:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        locale: [es, fr, pt, de, he, ar, uk, ru, ja, ko, hi, ur, fil, id]
      max-parallel: 3
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - uses: actions/setup-node@v6
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install openai

      - name: Run translation script
        run: node .github/scripts/translate-multi-backend.js
        env:
          TRANSLATION_BACKEND: ${{ github.event.inputs.backend || 'openai' }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          LIBRETRANSLATE_URL: ${{ secrets.LIBRETRANSLATE_URL || 'https://libretranslate.com' }}
          LIBRETRANSLATE_API_KEY: ${{ secrets.LIBRETRANSLATE_API_KEY }}
          TARGET_LOCALE: ${{ matrix.locale }}
          FORCE_RETRANSLATE: ${{ github.event.inputs.force_retranslate || 'false' }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: 'i18n: Update ${{ matrix.locale }} translations'
          branch: i18n/auto-translate-${{ matrix.locale }}
          title: 'i18n: Update ${{ matrix.locale }} translations'
          body: |
            ## Automated Translation Update

            **Locale:** ${{ matrix.locale }}
            **Trigger:** ${{ github.event_name }}
            **Source:** English JSON files in `website/src/i18n/locales/en/`

            This PR was automatically generated by the translation workflow using OpenAI GPT-4.

            ### Checklist
            - [ ] Review translated strings for accuracy
            - [ ] Check placeholders like `{count}`, `{name}` are preserved
            - [ ] Verify brand names like "Caro" remain unchanged
            - [ ] Test RTL rendering for Hebrew/Arabic/Urdu
            - [ ] Build website to verify no syntax errors

            ðŸ¤– Generated with automated translation workflow
          labels: |
            i18n
            automated
          assignees: wildcard
