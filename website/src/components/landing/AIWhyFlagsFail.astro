---
/**
 * Why Flags Fail - Contrasting flag-based vs pattern-based approaches
 * Shows real examples of how safety flags failed in Claude and Gemini
 */

const flagFailures = [
  {
    tool: "Claude Code",
    flag: "--dangerously-skip-permissions",
    whatHappened: "AI ran rm -rf ~/ anyway, deleting the user's entire home directory",
    why: "The flag controls permission prompts, not command validation. The AI didn't need permission‚Äîit just executed.",
    source: "HN Discussion, Dec 2025"
  },
  {
    tool: "Gemini CLI",
    flag: "Built-in safety checks",
    whatHappened: "AI hallucinated file paths that didn't exist, then confidently deleted real files while 'cleaning up'",
    why: "LLMs are stochastic. They make up data with high confidence. Safety checks can't catch hallucinations.",
    source: "HN Discussion, Jul 2025"
  }
];
---

<section id="why-flags-fail" class="section">
  <div class="container">
    <h2>Why Flags Aren't Enough</h2>
    <p class="section-subtitle">Real incidents from 2025 where safety measures failed</p>

    <div class="failures-grid">
      {flagFailures.map((failure) => (
        <div class="failure-card">
          <div class="failure-header">
            <span class="tool-badge">{failure.tool}</span>
            <code class="flag">{failure.flag}</code>
          </div>
          <div class="failure-content">
            <div class="what-happened">
              <span class="label">What happened:</span>
              <p>{failure.whatHappened}</p>
            </div>
            <div class="why">
              <span class="label">Why it failed:</span>
              <p>{failure.why}</p>
            </div>
          </div>
          <div class="failure-source">‚Äî {failure.source}</div>
        </div>
      ))}
    </div>

    <div class="comparison">
      <h3>Flag-Based Safety vs Pattern-Based Safety</h3>
      <div class="comparison-grid">
        <div class="approach flag-approach">
          <div class="approach-header bad">
            <span class="approach-icon">‚ùå</span>
            <span class="approach-title">Flag-Based (Others)</span>
          </div>
          <ul class="approach-list">
            <li>Trust the AI to remember the flag</li>
            <li>Hope the flag covers all edge cases</li>
            <li>Can't catch hallucinated commands</li>
            <li>Probabilistic protection</li>
            <li>Fails silently when AI gets creative</li>
          </ul>
        </div>
        <div class="approach pattern-approach">
          <div class="approach-header good">
            <span class="approach-icon">‚úì</span>
            <span class="approach-title">Pattern-Based (Caro)</span>
          </div>
          <ul class="approach-list">
            <li>Validates every command, regardless of source</li>
            <li>52+ dangerous patterns compiled in</li>
            <li>Catches hallucinations‚Äîpattern is pattern</li>
            <li>Deterministic protection</li>
            <li>Explicit warnings before execution</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="key-insight">
      <div class="insight-icon">üí°</div>
      <div class="insight-content">
        <strong>The key difference:</strong> Flags ask "did the user consent?"
        Caro asks "is this command dangerous?" The AI doesn't need consent to run rm -rf ~/.
        It needs to be stopped.
      </div>
    </div>
  </div>
</section>

<style>
  .section {
    padding: 80px 20px;
    background: var(--color-bg);
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
  }

  h2 {
    font-size: 36px;
    text-align: center;
    margin-bottom: 12px;
    color: var(--color-text);
  }

  h3 {
    font-size: 24px;
    text-align: center;
    margin-bottom: 32px;
    color: var(--color-text);
  }

  .section-subtitle {
    text-align: center;
    color: var(--color-text-secondary);
    font-size: 18px;
    margin-bottom: 50px;
  }

  .failures-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin-bottom: 60px;
  }

  .failure-card {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, var(--color-bg-secondary) 100%);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    padding: 28px;
  }

  .failure-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .tool-badge {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 4px 12px;
    border-radius: 20px;
  }

  .flag {
    font-family: 'SF Mono', 'Monaco', monospace;
    font-size: 13px;
    background: var(--color-bg);
    padding: 6px 12px;
    border-radius: 6px;
    color: var(--color-text-secondary);
  }

  .failure-content {
    margin-bottom: 16px;
  }

  .what-happened,
  .why {
    margin-bottom: 16px;
  }

  .label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--color-text-secondary);
    margin-bottom: 6px;
  }

  .what-happened p {
    color: #ef4444;
    font-size: 15px;
    line-height: 1.6;
    margin: 0;
  }

  .why p {
    color: var(--color-text-secondary);
    font-size: 14px;
    line-height: 1.6;
    margin: 0;
    font-style: italic;
  }

  .failure-source {
    font-size: 12px;
    color: var(--color-text-secondary);
  }

  .comparison {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 40px;
    margin-bottom: 40px;
  }

  .comparison-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
  }

  .approach {
    padding: 24px;
    border-radius: 8px;
  }

  .flag-approach {
    background: rgba(239, 68, 68, 0.05);
    border: 1px solid rgba(239, 68, 68, 0.2);
  }

  .pattern-approach {
    background: rgba(34, 197, 94, 0.05);
    border: 1px solid rgba(34, 197, 94, 0.2);
  }

  .approach-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--color-border);
  }

  .approach-header.bad .approach-icon {
    color: #ef4444;
    font-size: 20px;
  }

  .approach-header.good .approach-icon {
    color: #22c55e;
    font-size: 20px;
  }

  .approach-title {
    font-weight: 600;
    font-size: 16px;
    color: var(--color-text);
  }

  .approach-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .approach-list li {
    padding: 8px 0;
    font-size: 14px;
    color: var(--color-text-secondary);
    padding-left: 24px;
    position: relative;
  }

  .flag-approach .approach-list li::before {
    content: "‚úó";
    position: absolute;
    left: 0;
    color: #ef4444;
  }

  .pattern-approach .approach-list li::before {
    content: "‚úì";
    position: absolute;
    left: 0;
    color: #22c55e;
  }

  .key-insight {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    background: linear-gradient(135deg, rgba(255, 140, 66, 0.08) 0%, rgba(255, 107, 53, 0.04) 100%);
    border: 1px solid rgba(255, 140, 66, 0.2);
    border-radius: 12px;
    padding: 28px;
  }

  .insight-icon {
    font-size: 32px;
    flex-shrink: 0;
  }

  .insight-content {
    font-size: 16px;
    color: var(--color-text-secondary);
    line-height: 1.7;
  }

  .insight-content strong {
    color: var(--color-text);
  }

  @media (max-width: 900px) {
    .failures-grid,
    .comparison-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    h2 {
      font-size: 28px;
    }

    .comparison {
      padding: 24px;
    }

    .key-insight {
      flex-direction: column;
      text-align: center;
    }
  }
</style>
