---
import DocsLayout from '../../layouts/DocsLayout.astro';
---

<DocsLayout
  title="Safety Levels"
  description="Understanding Caro's command validation and safety features"
>
  <h1>Safety Levels</h1>

  <p>
    Caro includes a comprehensive safety system that validates all generated commands
    before execution. This page explains how safety validation works and how to
    configure it for your needs.
  </p>

  <h2>How Safety Validation Works</h2>

  <p>Every command generated by Caro goes through multiple validation steps:</p>

  <ol>
    <li><strong>Pattern Matching</strong> - Checks against known dangerous command patterns</li>
    <li><strong>Risk Assessment</strong> - Evaluates the potential impact of the command</li>
    <li><strong>POSIX Compliance</strong> - Verifies the command uses standard utilities</li>
    <li><strong>Path Validation</strong> - Checks for operations on protected system paths</li>
  </ol>

  <h2>Risk Levels</h2>

  <p>Commands are classified into four risk levels:</p>

  <h3>Safe</h3>
  <p>
    Commands that only read data or have no lasting effects.
    These execute without confirmation.
  </p>
  <pre><code>ls -la
cat file.txt
pwd
date</code></pre>

  <h3>Moderate</h3>
  <p>
    Commands that modify user data but are generally reversible.
    May require confirmation depending on safety level.
  </p>
  <pre><code>mv file.txt backup/
cp -r src/ dest/
git commit -m "message"</code></pre>

  <h3>High</h3>
  <p>
    Commands that can cause significant data loss or system changes.
    Require confirmation in moderate and strict modes.
  </p>
  <pre><code>rm -rf directory/
chmod -R 777 folder/
sudo apt-get remove package</code></pre>

  <h3>Critical</h3>
  <p>
    Commands that could damage the system or cause irreversible data loss.
    Blocked in strict and moderate modes.
  </p>
  <pre><code>rm -rf /
mkfs.ext4 /dev/sda
dd if=/dev/zero of=/dev/sda</code></pre>

  <h2>Safety Levels</h2>

  <h3>Strict</h3>
  <p>Maximum protection for production systems and sensitive data:</p>
  <ul>
    <li><strong>Blocks</strong>: High and Critical risk commands</li>
    <li><strong>Confirms</strong>: Moderate risk commands</li>
    <li><strong>Allows</strong>: Safe commands</li>
  </ul>
  <pre><code>$ caro --safety strict "delete all log files"</code></pre>

  <h3>Moderate (Default)</h3>
  <p>Balanced protection for everyday use:</p>
  <ul>
    <li><strong>Blocks</strong>: Critical risk commands</li>
    <li><strong>Confirms</strong>: High risk commands</li>
    <li><strong>Allows</strong>: Safe and Moderate commands</li>
  </ul>
  <pre><code>$ caro --safety moderate "cleanup temp files"</code></pre>

  <h3>Permissive</h3>
  <p>Minimal restrictions for experienced users:</p>
  <ul>
    <li><strong>Blocks</strong>: Nothing (only warns)</li>
    <li><strong>Confirms</strong>: Critical risk commands</li>
    <li><strong>Allows</strong>: All other commands with warnings</li>
  </ul>
  <pre><code>$ caro --safety permissive "format disk"</code></pre>

  <div class="callout callout-warning">
    <strong>Warning</strong>
    Permissive mode should only be used when you fully understand the risks
    and are working in a safe environment like a VM or container.
  </div>

  <h2>Dangerous Command Patterns</h2>

  <p>Caro blocks or warns about these known dangerous patterns:</p>

  <h3>Filesystem Destruction</h3>
  <ul>
    <li><code>rm -rf /</code> - Remove root filesystem</li>
    <li><code>rm -rf ~</code> - Remove home directory</li>
    <li><code>rm -rf /*</code> - Remove all files</li>
  </ul>

  <h3>Disk Operations</h3>
  <ul>
    <li><code>mkfs.*</code> - Format disk</li>
    <li><code>dd if=/dev/zero</code> - Overwrite with zeros</li>
    <li><code>fdisk</code> - Modify partitions</li>
  </ul>

  <h3>System Paths</h3>
  <ul>
    <li><code>/bin</code>, <code>/sbin</code> - System binaries</li>
    <li><code>/usr</code> - User programs</li>
    <li><code>/etc</code> - System configuration</li>
    <li><code>/boot</code> - Boot files</li>
  </ul>

  <h3>Other Dangerous Patterns</h3>
  <ul>
    <li>Fork bombs: <code>:(){ :|:& };:</code></li>
    <li>Recursive chmod: <code>chmod -R 777 /</code></li>
    <li>Hidden sudo: Commands that escalate privileges unexpectedly</li>
  </ul>

  <h2>Bypassing Safety (Use with Caution)</h2>

  <p>
    The <code>--confirm</code> flag bypasses confirmation prompts.
    Use only when you're certain about the command:
  </p>

  <pre><code># Skip confirmation (dangerous!)
$ caro --confirm "remove all temp files"</code></pre>

  <div class="callout callout-danger">
    <strong>Danger</strong>
    Never use <code>--confirm</code> with commands you haven't reviewed.
    Never use it in automated scripts without careful review.
  </div>

  <h2>Best Practices</h2>

  <ul>
    <li>Use <strong>strict</strong> mode on production systems</li>
    <li>Use <strong>moderate</strong> mode for daily development</li>
    <li>Use <strong>permissive</strong> mode only in isolated environments</li>
    <li>Always review commands before execution</li>
    <li>Use <code>--dry-run</code> to preview dangerous operations</li>
  </ul>
</DocsLayout>
